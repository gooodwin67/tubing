import{C as qe,S as mt,a as yt,F as _t,H as ht,b as St,D as gt,c as wt,A as bt,P as Dt,W as ft,G as Fe,V as q,B as U,R as Ce,d as xt,e as vt,f as ce}from"./three-Dhj7f3wh.js";import{O as p}from"./@dimforge-D3Mqfikn.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();function Je(){let e=window.matchMedia||window.msMatchMedia;return e?e("(pointer:coarse)").matches:!1}function je(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}function Y(e){const t=e/1e3,o=Math.floor(t),r=Math.floor((t-o)*1e3),a=Math.floor(o/60),l=o%60;return`${String(a).padStart(2,"0")}:${String(l).padStart(2,"0")}.${String(r).padStart(3,"0")}`}let N=document.querySelector(".main_load"),Ne=document.querySelector(".main_menu"),Ge=document.querySelector(".select_level"),Le=document.querySelectorAll(".select_level .level_shadow"),qt=document.querySelector(".select_tube"),Ct=document.querySelector(".finish_window"),Lt=document.querySelector(".finish_you_time .finish_you_time_time"),We=document.querySelector(".boom_window"),de=document.querySelector(".main_record"),At=document.querySelectorAll("body>.overlay"),zt=document.querySelector(".startButton"),kt=document.querySelectorAll(".load_level_wrap .btn_lev"),Ve=document.querySelectorAll(".load_level_wrap .level_time"),Ke=document.querySelectorAll(".load_tubes_wrap>div"),ue=document.querySelectorAll(".language_block img"),Ue=[],Ye=[],te=0,Qe=document.querySelector(".times"),Ae=document.querySelector(".current_time"),$e=document.querySelector(".best_time"),Et=document.querySelector(".finish_window .finish_again"),Tt=document.querySelector(".finish_window .finish_in_menu"),Rt=document.querySelector(".boom_window .finish_again"),Mt=document.querySelector(".boom_window .finish_in_menu"),Xe=document.querySelector(".speed_block"),Ze=document.querySelector(".speed_block>.speed"),Bt=document.querySelector(".instr_check"),pe=document.querySelector(".load_percent");document.querySelector(".records_wrap>div");let ze=document.querySelector(".pause_button_wrap"),Ht=document.querySelector(".close_pause_button"),Pt=document.querySelector(".reset_button"),It=document.querySelector(".inmenu_button"),Ot=document.querySelector(".before_start"),Ft=document.querySelector(".instruction_start_btn"),Jt=document.querySelector(".menu_in_game_wrap"),ke=document.querySelector(".start_time"),et=document.querySelector(".start_time_wrap"),me=document.querySelector(".audio_button");window.oncontextmenu=function(e){return!1},ue.forEach((e,t)=>{e.addEventListener("click",()=>{te!=t&&(ue.forEach(o=>{o.classList.remove("selected")}),e.classList.add("selected"),te=t,tt(te))})});function tt(e){e==0?(document.querySelector(".title_game").src="./images/title.png",document.querySelector(".startgame_title").textContent="\u043D\u0430\u0447\u0430\u0442\u044C \u0438\u0433\u0440\u0443",document.querySelector(".language_title").textContent="\u042F\u0437\u044B\u043A:",document.querySelectorAll(".level_text h2>span").forEach(t=>{t.textContent="\u0423\u0440\u043E\u0432\u0435\u043D\u044C"}),document.querySelectorAll(".leveltime_title").forEach(t=>{t.textContent="\u0412\u0440\u0435\u043C\u044F: "}),document.querySelectorAll(".load_tubes_wrap .selecttube_title").forEach(t=>{t.textContent="\u0422\u044E\u0431\u0438\u043D\u0433"}),document.querySelectorAll(".load_tubes_wrap .selecttubespeed_title").forEach(t=>{t.textContent="\u0421\u043A\u043E\u0440\u043E\u0441\u0442\u044C: "}),document.querySelectorAll(".load_tubes_wrap .selecttubecontrol_title").forEach(t=>{t.textContent="\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435: "}),document.querySelectorAll(".load_level_wrap .btn_lev").forEach(t=>{t.textContent="\u041D\u0430\u0447\u0430\u0442\u044C"}),document.querySelectorAll(".load_level_wrap .ad_res").forEach(t=>{t.textContent="\u041F\u0440\u043E\u043F\u0443\u0441\u0442\u0438\u0442\u044C"}),document.querySelector(".selecttubedesc_title").textContent="\u041F\u0440\u043E\u0445\u043E\u0434\u0438\u0442\u0435 \u0443\u0440\u043E\u0432\u043D\u0438, \u0447\u0442\u043E\u0431\u044B \u0440\u0430\u0437\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0442\u044E\u0431\u0438\u043D\u0433\u0438",document.querySelector(".menu_in_game_wrap_head").textContent="\u041F\u0430\u0443\u0437\u0430",document.querySelector(".close_pause_button").textContent="\u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C \u0438\u0433\u0440\u0443",document.querySelector(".reset_button").textContent="\u041D\u0430\u0447\u0430\u0442\u044C \u0437\u0430\u043D\u043E\u0432\u043E",document.querySelector(".inmenu_button").textContent="\u0412\u044B\u0439\u0442\u0438",document.querySelector(".finish_you_time_title").textContent="\u0412\u0430\u0448\u0435 \u0432\u0440\u0435\u043C\u044F: ",document.querySelector(".crash_title").textContent="\u0412\u044B \u0432\u0440\u0435\u0437\u0430\u043B\u0438\u0441\u044C",document.querySelector(".finish_title").textContent="\u0412\u044B \u043F\u0440\u0438\u0435\u0445\u0430\u043B\u0438",document.querySelectorAll(".finish_again").forEach(t=>{t.textContent="\u0415\u0449\u0435 \u0440\u0430\u0437"}),document.querySelectorAll(".finish_in_menu").forEach(t=>{t.textContent="\u0412\u044B\u0431\u043E\u0440 \u0443\u0440\u043E\u0432\u043D\u044F"}),document.querySelector(".current_time_title").textContent="\u0412\u0440\u0435\u043C\u044F",document.querySelector(".best_time_title").textContent="\u041B\u0443\u0447\u0448\u0435\u0435 \u0432\u0440\u0435\u043C\u044F",document.querySelector(".speed_title").textContent="\u041A\u041C/\u0427",document.querySelector(".instruction_start_btn").textContent="\u0421\u0422\u0410\u0420\u0422",document.querySelector(".instr-disabled span").textContent="\u0411\u043E\u043B\u044C\u0448\u0435 \u043D\u0435 \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C",document.querySelector(".desktop_instr").innerHTML=`<h2>\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435</h2>
    <span>\u0411\u044B\u0441\u0442\u0440\u043E \u043D\u0430\u0436\u0438\u043C\u0430\u0439\u0442\u0435 <span class='button_active'>W</span> \u0438\u043B\u0438 <span class='button_active'>\u2191</span> \u0447\u0442\u043E\u0431\u044B \u0440\u0430\u0437\u043E\u0433\u043D\u0430\u0442\u044C\u0441\u044F \u0434\u043E \u0441\u0442\u0430\u0440\u0442\u043E\u0432\u043E\u0439 \u043E\u0442\u043C\u0435\u0442\u043A\u0438</span>
    <span>\u041A\u043B\u0430\u0432\u0438\u0448\u0430\u043C\u0438 <span>\u2190</span> <span>\u2192</span> \u0438\u043B\u0438 <span>A</span> <span>D</span> \u0443\u043F\u0440\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u0442\u044E\u0431\u0438\u043D\u0433\u043E\u043C</span>`,document.querySelector(".mobile_instr div").innerHTML=`<span>\u0411\u044B\u0441\u0442\u0440\u043E \u043D\u0430\u0436\u0438\u043C\u0430\u0439\u0442\u0435 \u043D\u0430 \u0437\u043E\u043D\u0443 <span> \u2191 </span> \u0447\u0442\u043E\u0431\u044B \u0440\u0430\u0437\u043E\u0433\u043D\u0430\u0442\u044C\u0441\u044F \u0434\u043E \u0441\u0442\u0430\u0440\u0442\u043E\u0432\u043E\u0439 \u043E\u0442\u043C\u0435\u0442\u043A\u0438</span>
    <span>\u041D\u0430\u0436\u0438\u043C\u0430\u044F \u043D\u0430 \u0437\u043E\u043D\u044B <span> \u2190 </span> \u0438 <span> \u2192 </span> \u0443\u043F\u0440\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u0442\u044E\u0431\u0438\u043D\u0433\u043E\u043C</span>`,document.querySelector(".sci-fi-loader strong").textContent="\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430",document.querySelector(".main_record_title").textContent="\u041C\u043E\u0435 \u043E\u0431\u0449\u0435\u0435 \u0432\u0440\u0435\u043C\u044F: ",H==0&&(document.querySelector(".main_record").textContent="\u041F\u0440\u043E\u0439\u0434\u0438\u0442\u0435 \u0432\u0441\u0435 \u0443\u0440\u043E\u0432\u043D\u0438, \u0447\u0442\u043E\u0431\u044B \u043F\u043E\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u0440\u0435\u043A\u043E\u0440\u0434"),document.querySelector(".records_wrap>p").textContent="\u041C\u0438\u0440\u043E\u0432\u043E\u0439 \u0440\u0435\u0439\u0442\u0438\u043D\u0433: "):(document.querySelector(".title_game").src="./images/title-en.png",document.querySelector(".startgame_title").textContent="start game",document.querySelector(".language_title").textContent="Language:",document.querySelectorAll(".level_text h2>span").forEach(t=>{t.textContent="Level"}),document.querySelectorAll(".leveltime_title").forEach(t=>{t.textContent="Time: "}),document.querySelectorAll(".load_tubes_wrap .selecttube_title").forEach(t=>{t.textContent="Tubing"}),document.querySelectorAll(".load_tubes_wrap .selecttubespeed_title").forEach(t=>{t.textContent="Speed: "}),document.querySelectorAll(".load_tubes_wrap .selecttubecontrol_title").forEach(t=>{t.textContent="Control: "}),document.querySelector(".selecttubedesc_title").textContent="Complete the levels to unlock the tubings",document.querySelector(".menu_in_game_wrap_head").textContent="Pause",document.querySelector(".close_pause_button").textContent="Continue",document.querySelector(".reset_button").textContent="Start again",document.querySelector(".inmenu_button").textContent="Exit to levels",document.querySelector(".finish_you_time_title").textContent="You time: ",document.querySelector(".crash_title").textContent="You crashed",document.querySelector(".finish_title").textContent="You finished",document.querySelectorAll(".finish_again").forEach(t=>{t.textContent="Again"}),document.querySelectorAll(".finish_in_menu").forEach(t=>{t.textContent="Select Level"}),document.querySelector(".current_time_title").textContent="Time",document.querySelector(".best_time_title").textContent="Best time",document.querySelector(".speed_title").textContent="KM/H",document.querySelector(".instruction_start_btn").textContent="START",document.querySelector(".instr-disabled span").textContent="Don't show again",document.querySelector(".desktop_instr").innerHTML=`<h2>Instructions</h2>
    <span>Quickly press <span class='button_active'>W</span> or <span class='button_active'>\u2191</span> to accelerate to the starting point</span>
    <span>Use <span>\u2190</span> <span>\u2192</span> or <span>A</span> <span>D</span> keys to control the tubing</span>`,document.querySelector(".mobile_instr div").innerHTML=`<span>Quickly press on zone <span> \u2191 </span> to accelerate to the starting point</span>
    <span>By taps on zones <span> \u2190 </span> and <span> \u2192 </span> control the tubing</span>`,document.querySelector(".sci-fi-loader strong").textContent="Loading ",document.querySelector(".main_record_title").textContent="My total time: ",H==0&&(document.querySelector(".main_record").textContent="Complete all the levels to set a record"),document.querySelector(".records_wrap>p").textContent="World Ranking: ",document.querySelectorAll(".load_level_wrap .btn_lev").forEach(t=>{t.textContent="Start"}),document.querySelectorAll(".load_level_wrap .ad_res").forEach(t=>{t.textContent="Skip"}))}document.querySelectorAll(".load_level_wrap .ad_res").forEach((e,t)=>{e.addEventListener("click",async()=>{w.ads.isRewardedAvailable&&w.ads.showRewardedVideo(),w.ads.on("rewarded:start",()=>{console.log("Video ad open."),he=!0,s!=null&&s.isPlaying&&s.stop()}),w.ads.on("rewarded:close",o=>{console.log("Video ad closed."),s!=null&&!s.isPlaying&&C&&s.play(),he=!1}),w.ads.on("rewarded:reward",async()=>{console.log("Rewarded! "+t),S(N),h.levelsTimes["time"+(t+1)]="120.111",ae=Object.keys(h.levelsTimes).length,localStorage.setItem("playerData",JSON.stringify(h)),await K(),await ee()})})}),kt.forEach((e,t)=>{e.addEventListener("click",async()=>{t+1<=Oe+1&&(G=t+1,Ke.forEach((o,r)=>{y[r].levels.includes(G)?(o.classList.remove("disabledTube"),y[r].canInLevel=!0):(o.classList.add("disabledTube"),y[r].canInLevel=!1)}),S(N),await re(!1,!0),S(qt))})}),Ke.forEach((e,t)=>{e.addEventListener("click",()=>{y[t].canInLevel&&(_=t,S(0),ne())})});function ne(){if(!h.canStart)S(Ot),R?document.querySelector(".mobile_instr").classList.remove("hidden_instr"):document.querySelector(".desktop_instr").classList.remove("hidden_instr");else{Qe.classList.remove("hidden_block"),Xe.classList.remove("hidden_block"),ye[_].position.copy(c.translation());let e=0;Re=!0,R&&document.querySelector(".instr-mobile-ingame").classList.remove("hidden_block"),R&&document.querySelector(".anim_tap_top").classList.remove("hidden_block");let t=setInterval(o=>{D!=null&&!D.isPlaying&&C&&!ie&&e==0&&D.play(),et.classList.remove("hidden_block"),ie||e++,e==2&&R&&document.querySelector(".instr-mobile-ingame").classList.add("hidden_block"),e==4?(Re=!1,te==0?ke.textContent="\u0421\u0422\u0410\u0420\u0422":ke.textContent="GO",P=!0,ze.classList.remove("hidden_block"),clearInterval(t),setTimeout(()=>{et.classList.add("hidden_block"),D==null||D.stop()},1500)):ke.textContent=4-e},1e3)}}Ft.addEventListener("click",()=>{h.canStart=!0,S(0),ne()}),me.addEventListener("click",()=>{C==!0?(me.classList.add("audio_off"),s!=null&&s.isPlaying&&s.stop(),d!=null&&d.isPlaying&&d.stop(),D!=null&&D.isPlaying&&D.stop(),C=!1):(me.classList.remove("audio_off"),s!=null&&!s.isPlaying&&s.play(),c.linvel().z>3&&n.userData.onGround&&!F&&(d==null||d.play()),C=!0)}),zt.addEventListener("click",()=>{R=Je(),Ie=je(),Ie&&me.classList.add("hidden_block"),te==0?_e=ot:_e=at,document.querySelector(".audio_button_wrap").classList.remove("hidden_block"),s!=null&&C&&s.play(),Ne.classList.add("hidden_block"),Ge.classList.remove("hidden_block")});function S(e){At.forEach(t=>{t.classList.add("hidden_block")}),e!=0&&e.classList.remove("hidden_block")}Et.addEventListener("click",async()=>{S(N),await K(),await re(!0,!0),S(0),ne()}),Rt.addEventListener("click",async()=>{S(N),await K(),await re(!0,!0),S(0),ne()}),Pt.addEventListener("click",async()=>{await K(),await re(!0,!0),S(0),ne()}),Tt.addEventListener("click",async()=>{S(N),await K(),await ee(),w.ads.isFullscreenAvailable&&w.ads.showFullscreen(),w.ads.on("fullscreen:start",()=>{s!=null&&s.isPlaying&&s.stop()}),w.ads.on("fullscreen:close",e=>{s!=null&&!s.isPlaying&&C&&s.play()})}),Mt.addEventListener("click",async()=>{S(N),await K(),await ee()}),It.addEventListener("click",async()=>{S(N),await K(),await ee()}),ze.addEventListener("click",()=>{Re==!1&&P&&!E&&(S(Jt),n.userData.time=k.getElapsedTime(),k.stop(),document.querySelector(".audio_button_wrap").classList.add("hidden_block"),d==null||d.stop(),s==null||s.stop(),F=!0)}),Ht.addEventListener("click",()=>{S(0),k.start(),k.elapsedTime=n.userData.time,document.querySelector(".audio_button_wrap").classList.remove("hidden_block"),C&&(s==null||s.play()),c.linvel().z>3&&n.userData.onGround&&C&&(d==null||d.play()),F=!1}),Bt.onchange=function(){this.checked?(h.canStart=!0,localStorage.setItem("playerData",JSON.stringify(h))):(h.canStart=!1,localStorage.setItem("playerData",JSON.stringify(h)))};let m,Ee=!0;performance.now();let G=0,F=!1,C=!0,H=0,oe=0,ae=0,nt=!1,n,c,Te,Re=!1,ye=[],_=0,J,_e,ot,at,ie=!1,he=!1,Me,E;const y=[{hSpeed:10,maxHSpeed:.08,stepSpeed:1,nowSpeed:0,maxSpeed:26,resetHAngle:!1,levels:[1,2,3,4,5,6,7,8,9],canInLevel:!1},{hSpeed:12,maxHSpeed:.1,stepSpeed:2,nowSpeed:0,maxSpeed:38,resetHAngle:!1,levels:[4,5,6,7,8,9],canInLevel:!1},{hSpeed:14,maxHSpeed:.12,stepSpeed:2,nowSpeed:0,maxSpeed:44,resetHAngle:!0,levels:[7,8,9],canInLevel:!1}];let d,s,T,D,it,L=[],Q=new q,jt=new Ce,P=!1,Be=!1,$,st,rt,g,I,O,A,z,Se,ge,we,X,Z,He,W=[],be=[],Pe=[],f,R=Je(),Ie=je(),Nt=new qe,k=new qe,De=0,lt=1/60,V=0,M=0,Oe=2,h;const ct=new Ce,Gt=new q(0,-1,0),u=new mt;u.background=new yt(14479094),u.fog=new _t(u.background,1,300);const se=new ht(16777215,16777215,2);se.color.setHSL(.6,1,.6),se.groundColor.setHSL(.095,1,.75),se.position.set(0,100,0),new St(se,10);const fe=new gt(16777215,3);fe.position.set(1,2,.2),fe.position.multiplyScalar(120),new wt(fe,10),new bt(11184810,1);const x=new Dt(85,document.body.offsetWidth/document.body.offsetHeight,.1,310);x.position.set(0,4,-10);const j=new ft({antialias:!1});j.setSize(document.body.offsetWidth,document.body.offsetHeight),document.body.appendChild(j.domElement),j.shadowMap.enabled=!1,window.addEventListener("resize",Wt,!1);function Wt(){R?(x.aspect=document.body.offsetWidth/document.body.offsetHeight,x.updateProjectionMatrix(),j.setSize(innerWidth,innerHeight)):(x.aspect=document.body.offsetWidth/document.body.offsetHeight,x.updateProjectionMatrix(),j.setSize(document.body.offsetWidth,document.body.offsetHeight))}async function Vt(){localStorage.getItem("playerData")?(h=JSON.parse(localStorage.getItem("playerData")),ue.forEach(e=>{e.classList.remove("selected")}),ae=Object.keys(h.levelsTimes).length,ae==Le.length&&(H=0,Object.values(h.levelsTimes).forEach(e=>{H+=parseFloat(e)}),de.textContent=Y(Math.round(H*1e3)),de.classList.add("main_record_green"))):(h={levelsTimes:{},canStart:!1},localStorage.setItem("playerData",JSON.stringify(h))),JSON.stringify(h),Oe=0,Le.forEach((e,t)=>{t<Object.keys(h.levelsTimes).length+1&&(Oe++,e.classList.remove("level_disabled"))}),Ve.forEach((e,t,o)=>{h.levelsTimes["time"+(t+1)]!=null?(e.childNodes[2].textContent=h.levelsTimes["time"+(t+1)],document.querySelectorAll(".load_level_wrap .ad_res").forEach((r,a)=>{(t==a||a==Ve.length-1)&&r.classList.add("not_vis")})):e.childNodes[2].textContent="00.000"})}async function Kt(){k=new qe,u.add(fe),u.add(se),M=0,await p.init(),m=new p.World(new p.Vector3(0,-9.81,0)),await new Fe().loadAsync("models/map-menu.glb",onprogress=l=>{let b=Math.min(Math.round(l.loaded/l.total*100),100);pe.textContent=b+"%"}).then(l=>{const b=l.scene;pe.textContent="0",b.traverse(i=>{if(i.name=="player")n=i.clone(),n.userData.vertices=n.geometry.attributes.position.array,n.userData.indices=n.geometry.index.array,n.material.transparent=!0,n.material.opacity=0,n.userData.mass=1,n.userData.playerBraking=!1,n.userData.hTransition=0,n.userData.currentSpeed=0,n.userData.boom=!1,n.userData.onStartArea=!0,n.userData.canBoostStep=!0,n.userData.time=0,n.userData.right=!1,n.userData.left=!1,n.userData.onGround=!1,n.userData.flying=!1,n.userData.origPosition=n.position,B(n),u.add(n);else if(i.name.includes("player-tube"))J=i.clone(),J.userData.startPosition=new q(J.position.x,J.position.y,J.position.z),ye[i.name.slice(-1)-1]=J,u.add(J);else if(i.name=="arrow_area")f=i.clone(),f.userData.hPos=0,u.add(f);else if(i.name.includes("ground"))new U().setFromObject(i).getSize(new q),$=i.clone(),$.userData.mass=0,B($),W.push($),u.add($),i.name=="left_ground_wall"?st=i.position:i.name=="right_ground_wall"&&(rt=i.position);else if(i.name.includes("wall")){new U().setFromObject(i).getSize(new q);let v=i.clone();v.userData.mass=1,B(v),W.push(v),be.push(v),u.add(v)}else if(i.name.includes("area")){let v=i.clone();u.add(v)}else i.name.includes("start_flag_en")?at=i.clone():i.name.includes("start_flag_ru")?ot=i.clone():i.name.includes("itsmen_body")?(g=i.clone(),g.material.transparent=!0,g.material.opacity=0,u.add(g),B(g)):i.name.includes("itsmen_left_hand")?(I=i.clone(),I.material.transparent=!0,I.material.opacity=0,u.add(I),B(I)):i.name.includes("itsmen_right_hand")?(O=i.clone(),O.material.transparent=!0,O.material.opacity=0,u.add(O),B(O)):i.name.includes("itsmen_left_leg")?(A=i.clone(),A.material.transparent=!0,A.material.opacity=0,u.add(A),B(A)):i.name.includes("itsmen_right_leg")?(z=i.clone(),z.material.transparent=!0,z.material.opacity=0,u.add(z),B(z)):i.name.includes("qmen_body")?(Se=i.clone(),u.add(Se)):i.name.includes("qmen_left_hand")?(ge=i.clone(),u.add(ge)):i.name.includes("qmen_right_hand")?(we=i.clone(),u.add(we)):i.name.includes("qmen_left_leg")?(X=i.clone(),u.add(X)):i.name.includes("qmen_right_leg")&&(Z=i.clone(),u.add(Z))})}),u.traverse(function(l){l.material&&(l.material.needsUpdate=!0)}),await Vt();let e=p.JointData.spherical({x:.2,y:0,z:-.2},{x:-.4,y:0,z:0});m.createImpulseJoint(e,g.userData.body,I.userData.body,!0);let t=p.JointData.spherical({x:-.2,y:0,z:-.2},{x:.4,y:0,z:0});m.createImpulseJoint(t,g.userData.body,O.userData.body,!0);let o=p.JointData.spherical({x:.22,y:0,z:.5},{x:0,y:0,z:-.5});m.createImpulseJoint(o,g.userData.body,A.userData.body,!0);let r=p.JointData.spherical({x:-.22,y:0,z:.5},{x:0,y:0,z:-.5});m.createImpulseJoint(r,g.userData.body,z.userData.body,!0);let a=p.JointData.spherical({x:0,y:0,z:0},{x:0,y:.3,z:0});He=m.createImpulseJoint(a,g.userData.body,c,!0),Be=!0}async function Ut(){u.add(_e),E=!1;const e=new Fe,t="models/map"+G+".glb";await e.loadAsync(t,onprogress=o=>{let r=Math.min(Math.round(o.loaded/o.total*100),100);pe.textContent=r+"%"}).then(o=>{const r=o.scene;pe.textContent="0",r.traverse(a=>{if(a.name.includes("ground")){new U().setFromObject(a).getSize(new q);let l=a.clone();l.userData.mass=0,l.name=a.name,B(l),W.push(l),u.add(l)}else if(a.name.includes("wall")){new U().setFromObject(a).getSize(new q);let l=a.clone();l.userData.mass=1,B(l),W.push(l),be.push(l),u.add(l)}else if(a.name.includes("moving_block")){const l=new U().setFromObject(a).getSize(new q);let b=a.clone();b.userData.size=l,b.userData.mass=1,b.userData.raycaster=new Ce,b.userData.speed=-a.name.substr(a.name.indexOf("speed")+6),b.userData.direction=new q(b.userData.speed,0,0),Ue.push(b),B(b),be.push(b),u.add(b)}else if(a.name.includes("area")){let l=a.clone();u.add(l)}else a.name.includes("finish_block")&&(Me=a.clone(),u.add(Me))})}),$e.textContent=h.levelsTimes["time"+G]}async function Yt(){const e=new xt,t=new vt;await t.loadAsync("audio/slide.mp3").then(o=>{d=new ce(e),d.setBuffer(o),d.setLoop(!0),d.setRefDistance(400),d.setVolume(.7),n.add(d)}).catch(o=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0430\u0443\u0434\u0438\u043E:",o)}),await t.loadAsync("audio/around.mp3").then(o=>{s=new ce(e),s.setBuffer(o),s.setLoop(!0),s.setRefDistance(400),s.setVolume(1),s.error=!1,n.add(s)}).catch(o=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0430\u0443\u0434\u0438\u043E:",o)}),await t.loadAsync("audio/boom1.mp3").then(o=>{T=new ce(e),T.setBuffer(o),T.setLoop(!1),T.setRefDistance(400),T.setVolume(.3),T.error=!1,n.add(T)}).catch(o=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0430\u0443\u0434\u0438\u043E:",o)}),await t.loadAsync("audio/bip.mp3").then(o=>{D=new ce(e),D.setBuffer(o),D.setLoop(!1),D.setRefDistance(400),D.setVolume(.3),D.error=!1,n.add(D)}).catch(o=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0430\u0443\u0434\u0438\u043E:",o)})}let w;window.gp!=null?(w=window.gp,ee()):window.onGPInit=async function(e){console.log("000"),w=e,ee()};async function ee(){if(await re(!0,!1),Ee){await w.player.ready,w.ads.isPreloaderAvailable&&gp.ads.canShowFullscreenBeforeGamePlay&&await gp.ads.showPreloader(),w.ads.isStickyAvailable&&gp.ads.showSticky(),nt=!0,w.ads.isRewardedAvailable||document.querySelectorAll(".load_level_wrap .ad_res").forEach((v,xe)=>{v.classList.add("not_vis")});const e=await w.leaderboard.fetch({orderBy:["score"],order:"ASC",limit:4,withMe:"last",showNearest:0}),{players:t,fields:o,topPlayers:r,abovePlayers:a,belowPlayers:l,player:b}=e;let i=0;e.players.forEach((v,xe)=>{v.score!=0&&(i++,b.id==t[xe].id?(oe=v.score,document.querySelector(".records_wrap>div").innerHTML=document.querySelector(".records_wrap>div").innerHTML+'<p class = "main_record_green">'+i+". "+Y(v.score)+"</p>"):document.querySelector(".records_wrap>div").innerHTML=document.querySelector(".records_wrap>div").innerHTML+"<p>"+i+". "+Y(v.score)+"</p>")}),oe=w.player.get("score"),ue[0].classList.add("selected"),tt(0),S(Ne),Ee=!1}else S(Ge)}async function re(e,t){e&&await Kt(),t&&await Ut(),Ee&&!Ie&&Yt()}async function K(){for(P=!1,Be=!1,M=0,n.userData.time=0,n.userData.boom=!1,y.forEach(e=>{e.nowSpeed=0}),W=[],be=[],L=[],ze.classList.add("hidden_block"),Qe.classList.add("hidden_block"),Xe.classList.add("hidden_block"),document.querySelector(".audio_button_wrap").classList.remove("hidden_block"),k.start(),k.elapsedTime=n.userData.time,F=!1,n.userData.currentSpeed=0,Ze.textContent=n.userData.currentSpeed,M=0,Ae.textContent=M;u.children.length>0;){let e=u.children[0];e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(t=>t.dispose()):e.material.dispose()),u.remove(e)}E=!1,s!=null&&C&&!ie&&!he&&s.play()}function Qt(){if(Be&&!E&&(d!=null&&C&&(c.linvel().z>3&&n.userData.onGround?d.isPlaying||d.play():d.isPlaying&&d.stop()),R?n.userData.boom?(x.lookAt(g.position),d==null||d.stop()):(x.lookAt(new q(x.position.x,n.position.y,n.position.z+5)),x.position.y=n.position.y+5,x.position.z=n.position.z-3):n.userData.boom?(J.position.y>0&&x.lookAt(g.position),d==null||d.stop()):(x.lookAt(new q(x.position.x,n.position.y,n.position.z+5)),x.position.y=n.position.y+4,x.position.z=n.position.z-4),f.position.set(n.position.x,n.position.y,n.position.z+5)),P){E?(S(Ct),d==null||d.stop()):(M=k.getElapsedTime().toFixed(3),Ae.textContent=M,Xt(),$t()),n.position.x>st.x-n.userData.size.x/1.3&&(f.position.x=n.position.x,n.userData.hTransition=-.4),n.position.x<rt.x+n.userData.size.x/1.3&&(f.position.x=n.position.x,n.userData.hTransition=.4);let e=new p.EventQueue(!0);m.step(e),ye[_].position.copy(c.translation()),ye[_].quaternion.copy(c.rotation()),Se.position.copy(g.position),Se.rotation.copy(g.rotation),ge.position.copy(I.position),ge.rotation.copy(I.rotation),we.position.copy(O.position),we.rotation.copy(O.rotation),X.position.copy(A.position),X.rotation.copy(A.rotation),Z.position.copy(z.position),Z.rotation.copy(z.rotation);for(let t=0,o=L.length;t<o;t++)L[t][0].position.copy(L[t][1].translation()),L[t][0].quaternion.copy(L[t][1].rotation());e.drainCollisionEvents((t,o,r)=>{Pe.forEach((a,l)=>{c.handle==t&&a.handle==o&&!E?c.linvel().z<15&&n.userData.boom==!1&&(T!=null&&C&&T.play(),m.removeImpulseJoint(He),g.userData.body.applyImpulse({x:5,y:5,z:5},!0),g.userData.body.setEnabledRotations(!0),Te.setFriction(20),setTimeout(()=>{P=!1,S(We)},3e3),n.userData.boom=!0):c.handle==t&&!E&&c.linvel().z<15&&n.position.y<5&&n.userData.boom==!1&&(T!=null&&C&&T.play(),m.removeImpulseJoint(He),g.userData.body.applyImpulse({x:5,y:5,z:5},!0),g.userData.body.setEnabledRotations(!0),Te.setFriction(20),n.userData.boom=!0,setTimeout(()=>{P=!1,S(We)},3e3))})})}}j.setAnimationLoop(()=>{De+=Nt.getDelta(),De>lt&&!F&&(Qt(),j.render(u,x),De=De%lt)}),document.addEventListener("touchend",Zt),document.addEventListener("touchstart",dt),document.addEventListener("touchmove",dt),window.addEventListener("keydown",en),window.addEventListener("keyup",tn);function $t(){Ue.forEach((e,t)=>{let o=e,r=Ye[t];r.setLinvel(o.userData.direction,!0),r.setAngvel({x:o.userData.direction.z,y:o.userData.direction.y,z:-o.userData.direction.x},!0);const a=o.userData.direction;o.userData.raycaster.set(new q(o.position.x,.4,o.position.z),a.clone().normalize());const l=o.userData.raycaster.intersectObjects(W);l.length>0&&l[0].distance<o.userData.size.x/2&&(o.userData.direction.x=o.userData.direction.x*-1)})}async function Xt(){if(n.position.z>Me.position.z&&!n.userData.boom){if(M=k.getElapsedTime().toFixed(3),Ae.textContent=M,E=!0,Lt.textContent=M,h.levelsTimes["time"+G]!=null?V=parseFloat(h.levelsTimes["time"+G]):V=0,M<V||V==0){if(V=M,$e.textContent=V,h.levelsTimes["time"+G]=V,ae=Object.keys(h.levelsTimes).length,ae==Le.length&&(H=0,Object.values(h.levelsTimes).forEach(a=>{H+=parseFloat(a)}),de.textContent=Y(Math.round(H*1e3)),de.classList.add("main_record_green"),nt&&Math.round(H*1e3)<oe||oe==0)){w.player.set("score",Math.round(H*1e3)),await w.player.sync();const a=await w.leaderboard.fetch({orderBy:["score"],order:"ASC",limit:3,withMe:"last",showNearest:0}),{players:l,fields:b,topPlayers:i,abovePlayers:v,belowPlayers:xe,player:ut}=a;let ve=0;document.querySelector(".records_wrap>div").innerHTML="",a.players.forEach((le,pt)=>{le.score!=0&&(ve++,ut.id==l[pt].id?(oe=le.score,document.querySelector(".records_wrap>div").innerHTML=document.querySelector(".records_wrap>div").innerHTML+'<p class = "main_record_green">'+ve+". "+Y(le.score)+"</p>"):document.querySelector(".records_wrap>div").innerHTML=document.querySelector(".records_wrap>div").innerHTML+"<p>"+ve+". "+Y(le.score)+"</p>")})}localStorage.setItem("playerData",JSON.stringify(h))}n.position.z=0}f.position.x+=n.userData.hTransition;const e=new q().subVectors(c.translation(),f.position).normalize(),t=c.linvel(),o=new q(e.x*-y[_].hSpeed,t.y,e.z*-y[_].nowSpeed);c.translation().y<100&&c.translation().y>=20&&(y[_].nowSpeed+=.05,c.rotation().x<.04&&c.setRotation({w:c.rotation().w,x:.04,y:c.rotation().y,z:c.rotation().z})),c.translation().y<20&&c.translation().y>1&&c.lockRotations(!0,!0,!0,!0),c.setLinvel(o,!0),f.lookAt(f.position.x-(n.position.x-f.position.x),f.position.y-(n.position.y-f.position.y),f.position.z-(n.position.z-f.position.z)),c.setRotation({w:f.quaternion.w,x:c.rotation().x,y:f.quaternion.y,z:c.rotation().z}),g.userData.body.setRotation({w:f.quaternion.w,x:c.rotation().x,y:f.quaternion.y,z:c.rotation().z}),(X.rotation.y>0||X.rotation.y<0)&&A.userData.body.setRotation({w:A.userData.body.rotation().w,x:A.userData.body.rotation().x,y:0,z:A.userData.body.rotation().z}),(Z.rotation.y>0||Z.rotation.y<0)&&z.userData.body.setRotation({w:z.userData.body.rotation().w,x:z.userData.body.rotation().x,y:0,z:z.userData.body.rotation().z}),ct.set(n.position,Gt);const r=ct.intersectObjects(W);r.length>0&&(r[0].distance<.4?(n.userData.flying=!1,n.userData.onGround=!0):(n.userData.onGround=!1,n.userData.flying=!0)),c.linvel().z>0?n.userData.currentSpeed=c.linvel().z.toFixed(0):n.userData.currentSpeed=0,Ze.textContent=n.userData.currentSpeed,n.userData.left&&n.userData.onGround&&!n.userData.onStartArea&&(n.userData.hTransition<5&&(n.userData.hTransition+=y[_].maxHSpeed),y[_].nowSpeed-=.009),n.userData.right&&n.userData.onGround&&!n.userData.onStartArea&&(n.userData.hTransition>-5&&(n.userData.hTransition-=y[_].maxHSpeed),y[_].nowSpeed-=.009),y[_].resetHAngle&&!n.userData.left&&!n.userData.right&&(n.userData.hTransition<-y[_].maxHSpeed?n.userData.hTransition+=y[_].maxHSpeed:n.userData.hTransition>y[_].maxHSpeed?n.userData.hTransition-=y[_].maxHSpeed:n.userData.hTransition=0),n.position.z>_e.position.z?(n.userData.onStartArea==!0&&R&&document.querySelector(".anim_tap_top").classList.add("hidden_block"),n.userData.onStartArea==!0&&R&&document.querySelector(".anim_tap_left").classList.remove("hidden_block"),n.userData.onStartArea==!0&&R&&document.querySelector(".anim_tap_right").classList.remove("hidden_block"),n.userData.onStartArea==!0&&R&&setTimeout(()=>{document.querySelector(".anim_tap_left").classList.add("hidden_block"),document.querySelector(".anim_tap_right").classList.add("hidden_block")},2e3),n.userData.onStartArea=!1):n.userData.onStartArea=!0}function dt(e){if(n.userData.onGround){e=e.changedTouches[0];var t=j.domElement.getBoundingClientRect();Q.x=(e.clientX-t.left)/t.width*2-1,Q.y=-((e.clientY-t.top)/t.height)*2+1,jt.setFromCamera(Q,x),Q.y>0&&n.userData.canBoostStep&&P&&n.userData.onStartArea&&c.linvel().z<y[_].maxSpeed&&c.linvel().y<5&&c.linvel().y>-5&&!E&&y[_].nowSpeed<y[_].maxSpeed&&(y[_].nowSpeed+=y[_].stepSpeed),n.userData.canBoostStep=!1,Q.y<.5&&(Q.x>0?(n.userData.left=!1,n.userData.right=!0):(n.userData.right=!1,n.userData.left=!0))}}function Zt(e){n.userData.right=!1,n.userData.left=!1,n.userData.canBoostStep=!0}function en(e){switch(e.code){case"KeyW":case"ArrowUp":n.userData.canBoostStep&&P&&n.userData.onStartArea&&c.linvel().z<y[_].maxSpeed&&c.linvel().y<5&&c.linvel().y>-5&&!E&&y[_].nowSpeed<y[_].maxSpeed&&(y[_].nowSpeed+=y[_].stepSpeed),n.userData.canBoostStep=!1;break;case"KeyS":case"ArrowDown":break;case"KeyA":case"ArrowLeft":n.userData.left=!0;break;case"KeyD":case"ArrowRight":n.userData.right=!0;break}}function tn(e){switch(e.code){case"KeyW":case"ArrowUp":n.userData.canBoostStep=!0;break;case"KeyS":case"ArrowDown":break;case"KeyA":case"ArrowLeft":n.userData.left=!1;break;case"KeyD":case"ArrowRight":n.userData.right=!1;break}}function B(e){let t,o;const r=e.rotation.clone();e.rotation.set(0,0,0);const a=new U().setFromObject(e).getSize(new q);if(e.rotation.copy(r),e.name.includes("player")?(n.userData.size=a,n.userData.orgRotation=r,t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!1,!1).setLinearDamping(0).setAngularDamping(2)),o=p.ColliderDesc.cuboid(a.x/5,a.y/1.5,a.z/3).setMass(e.userData.mass).setRestitution(0).setFriction(0),c=t,Te=o,o.setActiveEvents(p.ActiveEvents.COLLISION_EVENTS),m.createCollider(o,t),n.userData.handle=c.handle,L.push([e,t,e.id])):e.name.includes("ground")&&(t=m.createRigidBody(p.RigidBodyDesc.fixed().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0)),o=p.ColliderDesc.cuboid(a.x/2,a.y/2,a.z/2).setMass(e.userData.mass).setRestitution(0).setFriction(0),m.createCollider(o,t),it=t,$.userData.handle=it.handle,L.push([e,t,e.id])),e.name.includes("wall")){t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!0,!1).setLinearDamping(0)),o=p.ColliderDesc.cuboid(a.x/2,a.y/2,a.z/2).setMass(e.userData.mass*10).setRestitution(0).setFriction(40);let l=m.createCollider(o,t);Pe.push(l),L.push([e,t,e.id])}if(e.name.includes("moving_block")){t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!0,!0,!0).setLinearDamping(0)),o=p.ColliderDesc.ball(a.x/2).setMass(e.userData.mass*10).setRestitution(0).setFriction(20);let l=t;Ye.push(l);let b=m.createCollider(o,t);Pe.push(b),L.push([e,t,e.id])}e.name.includes("itsmen_body")&&(t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!1,!0).setLinearDamping(0).setAngularDamping(0)),o=p.ColliderDesc.cuboid(a.x/2,a.y/2,a.z/2).setMass(0).setRestitution(0).setFriction(0).setDensity(2),g.userData.body=t,g.userData.collider=o,m.createCollider(o,t),L.push([e,t,e.id])),e.name.includes("itsmen_left_hand")&&(t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),o=p.ColliderDesc.capsule(a.z/2,a.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),I.userData.body=t,I.userData.collider=o,m.createCollider(o,t),L.push([e,t,e.id])),e.name.includes("itsmen_right_hand")&&(t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),o=p.ColliderDesc.capsule(a.z/2,a.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),O.userData.body=t,O.userData.collider=o,m.createCollider(o,t),L.push([e,t,e.id])),e.name.includes("itsmen_left_leg")&&(t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),o=p.ColliderDesc.capsule(a.z/2,a.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),A.userData.body=t,A.userData.collider=o,m.createCollider(o,t),L.push([e,t,e.id])),e.name.includes("itsmen_right_leg")&&(t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),o=p.ColliderDesc.capsule(a.z/2,a.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),z.userData.body=t,z.userData.collider=o,m.createCollider(o,t),L.push([e,t,e.id]))}document.addEventListener("visibilitychange",function(){document.visibilityState==="visible"?(ie=!1,C&&F==!1&&!he&&(s==null||s.play()),c.linvel().z>3&&n.userData.onGround&&C&&F==!1&&(d==null||d.play()),!E&&P&&F==!1&&(k.start(),k.elapsedTime=n.userData.time)):(ie=!0,D!=null&&D.isPlaying&&D.stop(),s==null||s.stop(),d==null||d.stop(),F==!1&&!E&&P&&(n.userData.time=k.getElapsedTime(),k.stop()))});
