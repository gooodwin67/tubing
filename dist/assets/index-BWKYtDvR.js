import{C as pe,S as Ve,a as Ye,F as Ue,H as Qe,b as $e,D as Xe,c as Ze,A as et,P as tt,W as nt,G as Ce,V as x,B as W,R as me,d as ot,e as at,f as ee}from"./three-Dhj7f3wh.js";import{O as p}from"./@dimforge-D3Mqfikn.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const a of c)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(c){const a={};return c.integrity&&(a.integrity=c.integrity),c.referrerPolicy&&(a.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?a.credentials="include":c.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(c){if(c.ep)return;c.ep=!0;const a=n(c);fetch(c.href,a)}})();function Le(){let e=window.matchMedia||window.msMatchMedia;return e?e("(pointer:coarse)").matches:!1}let j=document.querySelector(".main_load"),ze=document.querySelector(".main_menu"),ke=document.querySelector(".select_level"),st=document.querySelectorAll(".select_level .level_shadow"),it=document.querySelector(".select_tube"),rt=document.querySelector(".finish_window"),lt=document.querySelector(".finish_you_time .finish_you_time_time"),Ae=document.querySelector(".boom_window"),ct=document.querySelectorAll("body>.overlay"),dt=document.querySelector(".startButton"),ut=document.querySelectorAll(".load_level_wrap>div"),pt=document.querySelectorAll(".load_level_wrap .level_time"),Ee=document.querySelectorAll(".load_tubes_wrap>div"),te=document.querySelectorAll(".language_block>img"),Re=[],Te=[],Ie=document.querySelector(".times"),ye=document.querySelector(".current_time"),Be=document.querySelector(".best_time"),mt=document.querySelector(".finish_window .finish_again"),yt=document.querySelector(".finish_window .finish_in_menu"),ht=document.querySelector(".boom_window .finish_again"),gt=document.querySelector(".boom_window .finish_in_menu"),Pe=document.querySelector(".speed_block"),He=document.querySelector(".speed_block>.speed"),_t=document.querySelector(".instr_check"),ne=document.querySelector(".load_percent"),he=document.querySelector(".pause_button_wrap"),Dt=document.querySelector(".close_pause_button"),St=document.querySelector(".reset_button"),bt=document.querySelector(".inmenu_button"),ft=document.querySelector(".before_start"),wt=document.querySelector(".instruction_start_btn"),xt=document.querySelector(".menu_in_game_wrap"),Me=document.querySelector(".start_time"),Oe=document.querySelector(".start_time_wrap"),ge=document.querySelector(".audio_button");te.forEach((e,n)=>{e.addEventListener("click",()=>{g.language!=n&&(te.forEach(o=>{o.classList.remove("selected")}),e.classList.add("selected"),g.language=n,localStorage.setItem("playerData",JSON.stringify(g)),Fe(g.language))})});function Fe(e){e==0?(document.querySelector(".title_game").src="./images/title.png",document.querySelector(".startgame_title").textContent="\u043D\u0430\u0447\u0430\u0442\u044C \u0438\u0433\u0440\u0443",document.querySelector(".language_title").textContent="\u042F\u0437\u044B\u043A:",document.querySelectorAll(".level_text h2>span").forEach(n=>{n.textContent="\u0423\u0440\u043E\u0432\u0435\u043D\u044C"}),document.querySelectorAll(".leveltime_title").forEach(n=>{n.textContent="\u0412\u0440\u0435\u043C\u044F: "}),document.querySelectorAll(".load_tubes_wrap .selecttube_title").forEach(n=>{n.textContent="\u0422\u044E\u0431\u0438\u043D\u0433"}),document.querySelectorAll(".load_tubes_wrap .selecttubespeed_title").forEach(n=>{n.textContent="\u0421\u043A\u043E\u0440\u043E\u0441\u0442\u044C: "}),document.querySelectorAll(".load_tubes_wrap .selecttubecontrol_title").forEach(n=>{n.textContent="\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435: "}),document.querySelector(".selecttubedesc_title").textContent="\u041F\u0440\u043E\u0445\u043E\u0434\u0438\u0442\u0435 \u0443\u0440\u043E\u0432\u043D\u0438, \u0447\u0442\u043E\u0431\u044B \u0440\u0430\u0437\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0442\u044E\u0431\u0438\u043D\u0433\u0438",document.querySelector(".menu_in_game_wrap_head").textContent="\u041F\u0430\u0443\u0437\u0430",document.querySelector(".close_pause_button").textContent="\u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C \u0438\u0433\u0440\u0443",document.querySelector(".reset_button").textContent="\u041D\u0430\u0447\u0430\u0442\u044C \u0437\u0430\u043D\u043E\u0432\u043E",document.querySelector(".inmenu_button").textContent="\u0412\u044B\u0439\u0442\u0438",document.querySelector(".finish_you_time_title").textContent="\u0412\u0430\u0448\u0435 \u0432\u0440\u0435\u043C\u044F: ",document.querySelector(".crash_title").textContent="\u0412\u044B \u0432\u0440\u0435\u0437\u0430\u043B\u0438\u0441\u044C",document.querySelector(".finish_title").textContent="\u0412\u044B \u043F\u0440\u0438\u0435\u0445\u0430\u043B\u0438",document.querySelectorAll(".finish_again").forEach(n=>{n.textContent="\u0415\u0449\u0435 \u0440\u0430\u0437"}),document.querySelectorAll(".finish_in_menu").forEach(n=>{n.textContent="\u0412\u044B\u0431\u043E\u0440 \u0443\u0440\u043E\u0432\u043D\u044F"}),document.querySelector(".current_time_title").textContent="\u0412\u0440\u0435\u043C\u044F",document.querySelector(".best_time_title").textContent="\u041B\u0443\u0447\u0448\u0435\u0435 \u0432\u0440\u0435\u043C\u044F",document.querySelector(".speed_title").textContent="\u041A\u041C/\u0427",document.querySelector(".instruction_start_btn").textContent="\u0421\u0422\u0410\u0420\u0422",document.querySelector(".instr-disabled span").textContent="\u0411\u043E\u043B\u044C\u0448\u0435 \u043D\u0435 \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C",document.querySelector(".desktop_instr").innerHTML=`<h2>\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435</h2>
    <span>\u0411\u044B\u0441\u0442\u0440\u043E \u043D\u0430\u0436\u0438\u043C\u0430\u0439\u0442\u0435 <span class='button_active'>W</span> \u0438\u043B\u0438 <span class='button_active'>\u2191</span> \u0447\u0442\u043E\u0431\u044B \u0440\u0430\u0437\u043E\u0433\u043D\u0430\u0442\u044C\u0441\u044F \u0434\u043E \u0441\u0442\u0430\u0440\u0442\u043E\u0432\u043E\u0439 \u043E\u0442\u043C\u0435\u0442\u043A\u0438</span>
    <span>\u041A\u043B\u0430\u0432\u0438\u0448\u0430\u043C\u0438 <span>\u2190</span> <span>\u2192</span> \u0438\u043B\u0438 <span>A</span> <span>D</span> \u0443\u043F\u0440\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u0442\u044E\u0431\u0438\u043D\u0433\u043E\u043C</span>
    <span>\u0426\u0435\u043B\u044C - \u0434\u043E\u0435\u0445\u0430\u0442\u044C \u0434\u043E \u0444\u0438\u043D\u0438\u0448\u0430 \u0437\u0430 \u043A\u0440\u0430\u0442\u0447\u0430\u0439\u0448\u0435\u0435 \u0432\u0440\u0435\u043C\u044F</span>`,document.querySelector(".mobile_instr div").innerHTML=`<span>\u0411\u044B\u0441\u0442\u0440\u043E \u043D\u0430\u0436\u0438\u043C\u0430\u0439\u0442\u0435 \u043D\u0430 \u0437\u043E\u043D\u0443 <span> \u2191 </span> \u0447\u0442\u043E\u0431\u044B \u0440\u0430\u0437\u043E\u0433\u043D\u0430\u0442\u044C\u0441\u044F \u0434\u043E \u0441\u0442\u0430\u0440\u0442\u043E\u0432\u043E\u0439 \u043E\u0442\u043C\u0435\u0442\u043A\u0438</span>
    <span>\u041D\u0430\u0436\u0438\u043C\u0430\u044F \u043D\u0430 \u0437\u043E\u043D\u044B <span> \u2190 </span> \u0438 <span> \u2192 </span> \u0443\u043F\u0440\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u0442\u044E\u0431\u0438\u043D\u0433\u043E\u043C</span>`,document.querySelector(".sci-fi-loader strong").textContent="\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430"):(document.querySelector(".title_game").src="./images/title-en.png",document.querySelector(".startgame_title").textContent="start game",document.querySelector(".language_title").textContent="Language:",document.querySelectorAll(".level_text h2>span").forEach(n=>{n.textContent="Level"}),document.querySelectorAll(".leveltime_title").forEach(n=>{n.textContent="Time: "}),document.querySelectorAll(".load_tubes_wrap .selecttube_title").forEach(n=>{n.textContent="Tubing"}),document.querySelectorAll(".load_tubes_wrap .selecttubespeed_title").forEach(n=>{n.textContent="Speed: "}),document.querySelectorAll(".load_tubes_wrap .selecttubecontrol_title").forEach(n=>{n.textContent="Control: "}),document.querySelector(".selecttubedesc_title").textContent="Complete the levels to unlock the tubings",document.querySelector(".menu_in_game_wrap_head").textContent="Pause",document.querySelector(".close_pause_button").textContent="Continue",document.querySelector(".reset_button").textContent="Start again",document.querySelector(".inmenu_button").textContent="Exit to levels",document.querySelector(".finish_you_time_title").textContent="You time: ",document.querySelector(".crash_title").textContent="You crashed",document.querySelector(".finish_title").textContent="You finished",document.querySelectorAll(".finish_again").forEach(n=>{n.textContent="Again"}),document.querySelectorAll(".finish_in_menu").forEach(n=>{n.textContent="Select Level"}),document.querySelector(".current_time_title").textContent="Time",document.querySelector(".best_time_title").textContent="Best time",document.querySelector(".speed_title").textContent="KM/H",document.querySelector(".instruction_start_btn").textContent="START",document.querySelector(".instr-disabled span").textContent="Don't show again",document.querySelector(".desktop_instr").innerHTML=`<h2>Instructions</h2>
    <span>Quickly press <span class='button_active'>W</span> or <span class='button_active'>\u2191</span> to accelerate to the starting point</span>
    <span>Use <span>\u2190</span> <span>\u2192</span> or <span>A</span> <span>D</span> keys to control the tubing</span>
    <span>The goal is to reach the finish line in the shortest time</span>`,document.querySelector(".mobile_instr div").innerHTML=`<span>Quickly press on zone <span> \u2191 </span> to accelerate to the starting point</span>
    <span>By taps on zones <span> \u2190 </span> and <span> \u2192 </span> control the tubing</span>`,document.querySelector(".sci-fi-loader strong").textContent="Loading ")}ut.forEach((e,n)=>{e.addEventListener("click",async()=>{n+1<=qe&&(G=n+1,Ee.forEach((o,c)=>{y[c].levels.includes(G)?(o.classList.remove("disabledTube"),y[c].canInLevel=!0):(o.classList.add("disabledTube"),y[c].canInLevel=!1)}),D(j),await Z(!1,!0),D(it))})}),Ee.forEach((e,n)=>{e.addEventListener("click",()=>{y[n].canInLevel&&(h=n,D(0),$())})});function $(){if(!g.canStart)D(ft),M?document.querySelector(".mobile_instr").classList.remove("hidden_instr"):document.querySelector(".desktop_instr").classList.remove("hidden_instr");else{Ie.classList.remove("hidden_block"),Pe.classList.remove("hidden_block"),oe[h].position.copy(i.translation());let e=0;Se=!0,M&&document.querySelector(".instr-mobile-ingame").classList.remove("hidden_block"),M&&document.querySelector(".anim_tap").classList.remove("hidden_block");let n=setInterval(o=>{b!=null&&!b.isPlaying&&z&&!ae&&b.play(),Oe.classList.remove("hidden_block"),ae||e++,e==2&&M&&(document.querySelector(".instr-mobile-ingame").classList.add("hidden_block"),document.querySelector(".anim_tap").classList.add("hidden_block")),e==4?(b==null||b.stop(2.5),Se=!1,Me.textContent="GO",T=!0,he.classList.remove("hidden_block"),clearInterval(n),ysdk.features.GameplayAPI.start(),setTimeout(()=>{Oe.classList.add("hidden_block")},600)):Me.textContent=4-e},1e3)}}wt.addEventListener("click",()=>{g.canStart=!0,D(0),$()}),ge.addEventListener("click",()=>{z==!0?(ge.classList.add("audio_off"),d!=null&&d.isPlaying&&d.stop(),r!=null&&r.isPlaying&&r.stop(),b!=null&&b.isPlaying&&b.stop(),z=!1):(ge.classList.remove("audio_off"),d!=null&&!d.isPlaying&&d.play(),i.linvel().z>3&&t.userData.onGround&&!P&&(r==null||r.play()),z=!0)}),dt.addEventListener("click",()=>{M=Le(),document.querySelector(".audio_button_wrap").classList.remove("hidden_block"),d!=null&&z&&d.play(),M&&document.body.requestFullscreen().then(()=>{screen.orientation.lock("landscape")}),ze.classList.add("hidden_block"),ke.classList.remove("hidden_block")});function D(e){ct.forEach(n=>{n.classList.add("hidden_block")}),e!=0&&e.classList.remove("hidden_block")}mt.addEventListener("click",async()=>{D(j),await Q(),await Z(!0,!0),D(0),$()}),ht.addEventListener("click",async()=>{D(j),await Q(),await Z(!0,!0),D(0),$()}),St.addEventListener("click",async()=>{await Q(),await Z(!0,!0),D(0),$()}),yt.addEventListener("click",async()=>{D(j),await Q(),await ue(),ysdk.adv.showFullscreenAdv({callbacks:{onOpen:function(e){d!=null&&d.isPlaying&&d.stop()},onClose:function(e){d!=null&&!d.isPlaying&&d.play()},onError:function(e){}}})}),gt.addEventListener("click",async()=>{D(j),await Q(),await ue()}),bt.addEventListener("click",async()=>{D(j),await Q(),await ue()}),he.addEventListener("click",()=>{var e;Se==!1&&T&&!k&&((e=ysdk.features.GameplayAPI)==null||e.stop(),D(xt),t.userData.time=L.getElapsedTime(),L.stop(),document.querySelector(".audio_button_wrap").classList.add("hidden_block"),r==null||r.stop(),d==null||d.stop(),P=!0)}),Dt.addEventListener("click",()=>{var e;D(0),L.start(),L.elapsedTime=t.userData.time,document.querySelector(".audio_button_wrap").classList.remove("hidden_block"),z&&(d==null||d.play()),i.linvel().z>3&&t.userData.onGround&&z&&(r==null||r.play()),P=!1,(e=ysdk.features.GameplayAPI)==null||e.start()}),_t.onchange=function(){this.checked?(g.canStart=!0,localStorage.setItem("playerData",JSON.stringify(g))):(g.canStart=!1,localStorage.setItem("playerData",JSON.stringify(g)))};let m,_e=!0;performance.now();let G=0,P=!1,z=!0,t,i,De,Se=!1,oe=[],h=0,H,be,ae=!1,fe,k;const y=[{hSpeed:10,maxHSpeed:.08,stepSpeed:1,nowSpeed:0,maxSpeed:26,resetHAngle:!1,levels:[1,2,3,4,5,6,7,8,9],canInLevel:!1},{hSpeed:12,maxHSpeed:.1,stepSpeed:2,nowSpeed:0,maxSpeed:38,resetHAngle:!1,levels:[4,5,6,7,8,9],canInLevel:!1},{hSpeed:14,maxHSpeed:.12,stepSpeed:2,nowSpeed:0,maxSpeed:44,resetHAngle:!0,levels:[7,8,9],canInLevel:!1}];let r,d,A,b,Ge,v=[],K=new x,vt=new me,T=!1,we=!1,V,Je,Ne,_,I,B,q,C,se,ie,re,Y,U,xe,J=[],le=[],ve=[],f,M=Le(),qt=new pe,L=new pe,ce=0,We=1/60,N=0,E=0,qe=2,g;const je=new me,Ct=new x(0,-1,0),u=new Ve;u.background=new Ye(14479094),u.fog=new Ue(u.background,1,300);const X=new Qe(16777215,16777215,2);X.color.setHSL(.6,1,.6),X.groundColor.setHSL(.095,1,.75),X.position.set(0,100,0),new $e(X,10);const de=new Xe(16777215,3);de.position.set(1,2,.2),de.position.multiplyScalar(120),new Ze(de,10),new et(11184810,1);const w=new tt(85,document.body.offsetWidth/document.body.offsetHeight,.1,310);w.position.set(0,4,-10);const O=new nt({antialias:!0});O.setSize(document.body.offsetWidth,document.body.offsetHeight),document.body.appendChild(O.domElement),O.shadowMap.enabled=!1,window.addEventListener("resize",Lt,!1);function Lt(){M?(w.aspect=document.body.offsetWidth/document.body.offsetHeight,w.updateProjectionMatrix(),O.setSize(innerWidth,innerHeight)):(w.aspect=document.body.offsetWidth/document.body.offsetHeight,w.updateProjectionMatrix(),O.setSize(document.body.offsetWidth,document.body.offsetHeight))}async function zt(){localStorage.getItem("playerData")?(g=JSON.parse(localStorage.getItem("playerData")),te.forEach(e=>{e.classList.remove("selected")}),te[g.language].classList.add("selected"),Fe(g.language)):(g={levelsTimes:{},canStart:!1,language:0},localStorage.setItem("playerData",JSON.stringify(g))),JSON.stringify(g),qe=0,st.forEach((e,n)=>{n<Object.keys(g.levelsTimes).length+2&&(qe++,e.classList.remove("level_disabled"))}),pt.forEach((e,n,o)=>{g.levelsTimes["time"+(n+1)]!=null?e.childNodes[2].textContent=g.levelsTimes["time"+(n+1)]:e.childNodes[2].textContent="00.000"})}async function kt(){L=new pe,u.add(de),u.add(X),E=0,await p.init(),m=new p.World(new p.Vector3(0,-9.81,0)),await new Ce().loadAsync("models/map-menu.glb",onprogress=l=>{console.log(`Loaded: ${l.loaded}, Total: ${l.total}`);let S=Math.min(Math.round(l.loaded/l.total*100),100);ne.textContent=S+"%"}).then(l=>{const S=l.scene;ne.textContent="0",S.traverse(s=>{if(s.name=="player")t=s.clone(),t.userData.vertices=t.geometry.attributes.position.array,t.userData.indices=t.geometry.index.array,t.material.transparent=!0,t.material.opacity=0,t.userData.mass=1,t.userData.playerBraking=!1,t.userData.hTransition=0,t.userData.currentSpeed=0,t.userData.boom=!1,t.userData.onStartArea=!0,t.userData.canBoostStep=!0,t.userData.time=0,t.userData.right=!1,t.userData.left=!1,t.userData.onGround=!1,t.userData.flying=!1,t.userData.origPosition=t.position,R(t),u.add(t);else if(s.name.includes("player-tube"))H=s.clone(),H.userData.startPosition=new x(H.position.x,H.position.y,H.position.z),oe[s.name.slice(-1)-1]=H,u.add(H);else if(s.name=="arrow_area")f=s.clone(),f.userData.hPos=0,u.add(f);else if(s.name.includes("ground"))new W().setFromObject(s).getSize(new x),V=s.clone(),V.userData.mass=0,R(V),J.push(V),u.add(V),s.name=="left_ground_wall"?Je=s.position:s.name=="right_ground_wall"&&(Ne=s.position);else if(s.name.includes("wall")){new W().setFromObject(s).getSize(new x);let F=s.clone();F.userData.mass=1,R(F),J.push(F),le.push(F),u.add(F)}else if(s.name.includes("area")){let F=s.clone();u.add(F)}else s.name.includes("start_flag")?(be=s.clone(),u.add(be)):s.name.includes("itsmen_body")?(_=s.clone(),_.material.transparent=!0,_.material.opacity=0,u.add(_),R(_)):s.name.includes("itsmen_left_hand")?(I=s.clone(),I.material.transparent=!0,I.material.opacity=0,u.add(I),R(I)):s.name.includes("itsmen_right_hand")?(B=s.clone(),B.material.transparent=!0,B.material.opacity=0,u.add(B),R(B)):s.name.includes("itsmen_left_leg")?(q=s.clone(),q.material.transparent=!0,q.material.opacity=0,u.add(q),R(q)):s.name.includes("itsmen_right_leg")?(C=s.clone(),C.material.transparent=!0,C.material.opacity=0,u.add(C),R(C)):s.name.includes("qmen_body")?(se=s.clone(),u.add(se)):s.name.includes("qmen_left_hand")?(ie=s.clone(),u.add(ie)):s.name.includes("qmen_right_hand")?(re=s.clone(),u.add(re)):s.name.includes("qmen_left_leg")?(Y=s.clone(),u.add(Y)):s.name.includes("qmen_right_leg")&&(U=s.clone(),u.add(U))})}),u.traverse(function(l){l.material&&(l.material.needsUpdate=!0)}),await zt();let e=p.JointData.spherical({x:.2,y:0,z:-.2},{x:-.4,y:0,z:0});m.createImpulseJoint(e,_.userData.body,I.userData.body,!0);let n=p.JointData.spherical({x:-.2,y:0,z:-.2},{x:.4,y:0,z:0});m.createImpulseJoint(n,_.userData.body,B.userData.body,!0);let o=p.JointData.spherical({x:.22,y:0,z:.5},{x:0,y:0,z:-.5});m.createImpulseJoint(o,_.userData.body,q.userData.body,!0);let c=p.JointData.spherical({x:-.22,y:0,z:.5},{x:0,y:0,z:-.5});m.createImpulseJoint(c,_.userData.body,C.userData.body,!0);let a=p.JointData.spherical({x:0,y:0,z:0},{x:0,y:.3,z:0});xe=m.createImpulseJoint(a,_.userData.body,i,!0),we=!0}async function At(){k=!1;const e=new Ce,n="models/map"+G+".glb";await e.loadAsync(n,onprogress=o=>{let c=Math.min(Math.round(o.loaded/o.total*100),100);ne.textContent=c+"%"}).then(o=>{const c=o.scene;ne.textContent="0",c.traverse(a=>{if(a.name.includes("ground")){new W().setFromObject(a).getSize(new x);let l=a.clone();l.userData.mass=0,l.name=a.name,R(l),J.push(l),u.add(l)}else if(a.name.includes("wall")){new W().setFromObject(a).getSize(new x);let l=a.clone();l.userData.mass=1,R(l),J.push(l),le.push(l),u.add(l)}else if(a.name.includes("moving_block")){const l=new W().setFromObject(a).getSize(new x);let S=a.clone();S.userData.size=l,S.userData.mass=1,S.userData.raycaster=new me,S.userData.speed=-a.name.substr(a.name.indexOf("speed")+6),S.userData.direction=new x(S.userData.speed,0,0),Re.push(S),R(S),le.push(S),u.add(S)}else if(a.name.includes("area")){let l=a.clone();u.add(l)}else a.name.includes("finish_block")&&(fe=a.clone(),u.add(fe))})}),Be.textContent=g.levelsTimes["time"+G]}async function Et(){const e=new ot;t.add(e);const n=new at;await n.loadAsync("audio/slide.mp3").then(o=>{r=new ee(e),r.setBuffer(o),r.setLoop(!0),r.setRefDistance(40),r.setVolume(.7),t.add(r)}).catch(o=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0430\u0443\u0434\u0438\u043E:",o)}),await n.loadAsync("audio/around.mp3").then(o=>{d=new ee(e),d.setBuffer(o),d.setLoop(!0),d.setRefDistance(40),d.setVolume(1),d.error=!1,t.add(d)}).catch(o=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0430\u0443\u0434\u0438\u043E:",o)}),await n.loadAsync("audio/boom1.mp3").then(o=>{A=new ee(e),A.setBuffer(o),A.setLoop(!1),A.setRefDistance(40),A.setVolume(.9),A.error=!1,t.add(A)}).catch(o=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0430\u0443\u0434\u0438\u043E:",o)}),await n.loadAsync("audio/bip.mp3").then(o=>{b=new ee(e),b.setBuffer(o),b.setLoop(!1),b.setRefDistance(40),b.setVolume(.7),b.error=!1,t.add(b)}).catch(o=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0430\u0443\u0434\u0438\u043E:",o)})}async function ue(){await Z(!0,!1),_e?(D(ze),YaGames.init().then(e=>{var n;(n=e.features.LoadingAPI)==null||n.ready()}),_e=!1):D(ke)}ue();async function Z(e,n){e&&await kt(),n&&await At(),_e&&Et()}async function Q(){for(T=!1,we=!1,E=0,t.userData.time=0,t.userData.boom=!1,y.forEach(e=>{e.nowSpeed=0}),J=[],le=[],v=[],he.classList.add("hidden_block"),Ie.classList.add("hidden_block"),Pe.classList.add("hidden_block"),document.querySelector(".audio_button_wrap").classList.remove("hidden_block"),L.start(),L.elapsedTime=t.userData.time,P=!1,t.userData.currentSpeed=0,He.textContent=t.userData.currentSpeed,E=0,ye.textContent=E;u.children.length>0;){let e=u.children[0];e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(n=>n.dispose()):e.material.dispose()),u.remove(e)}k=!1}function Rt(){if(we&&!k&&(r!=null&&z&&(i.linvel().z>3&&t.userData.onGround?r.isPlaying||r.play():r.isPlaying&&r.stop()),M?t.userData.boom?(w.lookAt(_.position),r==null||r.stop()):(w.lookAt(new x(w.position.x,t.position.y,t.position.z+5)),w.position.y=t.position.y+5,w.position.z=t.position.z-3):t.userData.boom?(H.position.y>0&&w.lookAt(_.position),r==null||r.stop()):(w.lookAt(new x(w.position.x,t.position.y,t.position.z+5)),w.position.y=t.position.y+4,w.position.z=t.position.z-4),f.position.set(t.position.x,t.position.y,t.position.z+5)),T){k?(D(rt),r==null||r.stop()):(E=L.getElapsedTime().toFixed(3),ye.textContent=E,It(),Tt()),t.position.x>Je.x-t.userData.size.x/1.3&&(f.position.x=t.position.x,t.userData.hTransition=-.4),t.position.x<Ne.x+t.userData.size.x/1.3&&(f.position.x=t.position.x,t.userData.hTransition=.4);let e=new p.EventQueue(!0);m.step(e),oe[h].position.copy(i.translation()),oe[h].quaternion.copy(i.rotation()),se.position.copy(_.position),se.rotation.copy(_.rotation),ie.position.copy(I.position),ie.rotation.copy(I.rotation),re.position.copy(B.position),re.rotation.copy(B.rotation),Y.position.copy(q.position),Y.rotation.copy(q.rotation),U.position.copy(C.position),U.rotation.copy(C.rotation);for(let n=0,o=v.length;n<o;n++)v[n][0].position.copy(v[n][1].translation()),v[n][0].quaternion.copy(v[n][1].rotation());e.drainCollisionEvents((n,o,c)=>{ve.forEach((a,l)=>{var S,s;i.handle==n&&a.handle==o&&!k?i.linvel().z<15&&t.userData.boom==!1&&(A!=null&&z&&A.play(),m.removeImpulseJoint(xe),_.userData.body.applyImpulse({x:5,y:5,z:5},!0),_.userData.body.setEnabledRotations(!0),De.setFriction(20),setTimeout(()=>{T=!1,D(Ae)},3e3),(S=ysdk.features.GameplayAPI)==null||S.stop(),t.userData.boom=!0):i.handle==n&&!k&&i.linvel().z<15&&t.position.y<5&&t.userData.boom==!1&&(A!=null&&z&&A.play(),m.removeImpulseJoint(xe),_.userData.body.applyImpulse({x:5,y:5,z:5},!0),_.userData.body.setEnabledRotations(!0),De.setFriction(20),(s=ysdk.features.GameplayAPI)==null||s.stop(),t.userData.boom=!0,setTimeout(()=>{T=!1,D(Ae)},3e3))})})}}O.setAnimationLoop(()=>{ce+=qt.getDelta(),ce>We&&!P&&(Rt(),O.render(u,w),ce=ce%We)}),document.addEventListener("touchend",Bt),document.addEventListener("touchstart",Ke),document.addEventListener("touchmove",Ke),window.addEventListener("keydown",Pt),window.addEventListener("keyup",Ht);function Tt(){Re.forEach((e,n)=>{let o=e,c=Te[n];c.setLinvel(o.userData.direction,!0),c.setAngvel({x:o.userData.direction.z,y:o.userData.direction.y,z:-o.userData.direction.x},!0);const a=o.userData.direction;o.userData.raycaster.set(new x(o.position.x,.4,o.position.z),a.clone().normalize());const l=o.userData.raycaster.intersectObjects(J);l.length>0&&l[0].distance<o.userData.size.x/2&&(o.userData.direction.x=o.userData.direction.x*-1)})}function It(){var a;t.position.z>fe.position.z&&!t.userData.boom&&(E=L.getElapsedTime().toFixed(3),ye.textContent=E,k=!0,(a=ysdk.features.GameplayAPI)==null||a.stop(),lt.textContent=E,g.levelsTimes["time"+G]!=null?N=g.levelsTimes["time"+G]:N=0,(E<N||N==0)&&(N=E,Be.textContent=N,g.levelsTimes["time"+G]=N,localStorage.setItem("playerData",JSON.stringify(g))),t.position.z=0),f.position.x+=t.userData.hTransition;const e=new x().subVectors(i.translation(),f.position).normalize(),n=i.linvel(),o=new x(e.x*-y[h].hSpeed,n.y,e.z*-y[h].nowSpeed);i.translation().y<100&&i.translation().y>=20&&(y[h].nowSpeed+=.05,i.rotation().x<.04&&i.setRotation({w:i.rotation().w,x:.04,y:i.rotation().y,z:i.rotation().z})),i.translation().y<20&&i.translation().y>1&&i.lockRotations(!0,!0,!0,!0),i.setLinvel(o,!0),f.lookAt(f.position.x-(t.position.x-f.position.x),f.position.y-(t.position.y-f.position.y),f.position.z-(t.position.z-f.position.z)),i.setRotation({w:f.quaternion.w,x:i.rotation().x,y:f.quaternion.y,z:i.rotation().z}),_.userData.body.setRotation({w:f.quaternion.w,x:i.rotation().x,y:f.quaternion.y,z:i.rotation().z}),(Y.rotation.y>0||Y.rotation.y<0)&&q.userData.body.setRotation({w:q.userData.body.rotation().w,x:q.userData.body.rotation().x,y:0,z:q.userData.body.rotation().z}),(U.rotation.y>0||U.rotation.y<0)&&C.userData.body.setRotation({w:C.userData.body.rotation().w,x:C.userData.body.rotation().x,y:0,z:C.userData.body.rotation().z}),je.set(t.position,Ct);const c=je.intersectObjects(J);c.length>0&&(c[0].distance<.4?(t.userData.flying=!1,t.userData.onGround=!0):(t.userData.onGround=!1,t.userData.flying=!0)),i.linvel().z>0?t.userData.currentSpeed=i.linvel().z.toFixed(0):t.userData.currentSpeed=0,He.textContent=t.userData.currentSpeed,t.userData.left&&t.userData.onGround&&!t.userData.onStartArea&&(t.userData.hTransition<5&&(t.userData.hTransition+=y[h].maxHSpeed),y[h].nowSpeed-=.009),t.userData.right&&t.userData.onGround&&!t.userData.onStartArea&&(t.userData.hTransition>-5&&(t.userData.hTransition-=y[h].maxHSpeed),y[h].nowSpeed-=.009),y[h].resetHAngle&&!t.userData.left&&!t.userData.right&&(t.userData.hTransition<-y[h].maxHSpeed?t.userData.hTransition+=y[h].maxHSpeed:t.userData.hTransition>y[h].maxHSpeed?t.userData.hTransition-=y[h].maxHSpeed:t.userData.hTransition=0),t.position.z>be.position.z?t.userData.onStartArea=!1:t.userData.onStartArea=!0}function Ke(e){if(t.userData.onGround){e=e.changedTouches[0];var n=O.domElement.getBoundingClientRect();K.x=(e.clientX-n.left)/n.width*2-1,K.y=-((e.clientY-n.top)/n.height)*2+1,vt.setFromCamera(K,w),K.y>0&&t.userData.canBoostStep&&T&&t.userData.onStartArea&&i.linvel().z<y[h].maxSpeed&&i.linvel().y<5&&i.linvel().y>-5&&!k&&y[h].nowSpeed<y[h].maxSpeed&&(y[h].nowSpeed+=y[h].stepSpeed),t.userData.canBoostStep=!1,K.y<.5&&(K.x>0?(t.userData.left=!1,t.userData.right=!0):(t.userData.right=!1,t.userData.left=!0))}}function Bt(e){t.userData.right=!1,t.userData.left=!1,t.userData.canBoostStep=!0}function Pt(e){switch(e.code){case"KeyW":case"ArrowUp":t.userData.canBoostStep&&T&&t.userData.onStartArea&&i.linvel().z<y[h].maxSpeed&&i.linvel().y<5&&i.linvel().y>-5&&!k&&y[h].nowSpeed<y[h].maxSpeed&&(y[h].nowSpeed+=y[h].stepSpeed),t.userData.canBoostStep=!1;break;case"KeyS":case"ArrowDown":break;case"KeyA":case"ArrowLeft":t.userData.left=!0;break;case"KeyD":case"ArrowRight":t.userData.right=!0;break}}function Ht(e){switch(e.code){case"KeyW":case"ArrowUp":t.userData.canBoostStep=!0;break;case"KeyS":case"ArrowDown":break;case"KeyA":case"ArrowLeft":t.userData.left=!1;break;case"KeyD":case"ArrowRight":t.userData.right=!1;break}}function R(e){let n,o;const c=e.rotation.clone();e.rotation.set(0,0,0);const a=new W().setFromObject(e).getSize(new x);if(e.rotation.copy(c),e.name.includes("player")?(t.userData.size=a,t.userData.orgRotation=c,n=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!1,!1).setLinearDamping(0).setAngularDamping(2)),o=p.ColliderDesc.cuboid(a.x/5,a.y/1.5,a.z/3).setMass(e.userData.mass).setRestitution(0).setFriction(0),i=n,De=o,o.setActiveEvents(p.ActiveEvents.COLLISION_EVENTS),m.createCollider(o,n),t.userData.handle=i.handle,v.push([e,n,e.id])):e.name.includes("ground")&&(n=m.createRigidBody(p.RigidBodyDesc.fixed().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0)),o=p.ColliderDesc.cuboid(a.x/2,a.y/2,a.z/2).setMass(e.userData.mass).setRestitution(0).setFriction(0),m.createCollider(o,n),Ge=n,V.userData.handle=Ge.handle,v.push([e,n,e.id])),e.name.includes("wall")){n=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!0,!1).setLinearDamping(0)),o=p.ColliderDesc.cuboid(a.x/2,a.y/2,a.z/2).setMass(e.userData.mass*10).setRestitution(0).setFriction(40);let l=m.createCollider(o,n);ve.push(l),v.push([e,n,e.id])}if(e.name.includes("moving_block")){n=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!0,!0,!0).setLinearDamping(0)),o=p.ColliderDesc.ball(a.x/2).setMass(e.userData.mass*10).setRestitution(0).setFriction(20);let l=n;Te.push(l);let S=m.createCollider(o,n);ve.push(S),v.push([e,n,e.id])}e.name.includes("itsmen_body")&&(n=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!1,!0).setLinearDamping(0).setAngularDamping(0)),o=p.ColliderDesc.cuboid(a.x/2,a.y/2,a.z/2).setMass(0).setRestitution(0).setFriction(0).setDensity(2),_.userData.body=n,_.userData.collider=o,m.createCollider(o,n),v.push([e,n,e.id])),e.name.includes("itsmen_left_hand")&&(n=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),o=p.ColliderDesc.capsule(a.z/2,a.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),I.userData.body=n,I.userData.collider=o,m.createCollider(o,n),v.push([e,n,e.id])),e.name.includes("itsmen_right_hand")&&(n=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),o=p.ColliderDesc.capsule(a.z/2,a.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),B.userData.body=n,B.userData.collider=o,m.createCollider(o,n),v.push([e,n,e.id])),e.name.includes("itsmen_left_leg")&&(n=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),o=p.ColliderDesc.capsule(a.z/2,a.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),q.userData.body=n,q.userData.collider=o,m.createCollider(o,n),v.push([e,n,e.id])),e.name.includes("itsmen_right_leg")&&(n=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),o=p.ColliderDesc.capsule(a.z/2,a.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),C.userData.body=n,C.userData.collider=o,m.createCollider(o,n),v.push([e,n,e.id]))}document.addEventListener("visibilitychange",function(){var e,n;document.visibilityState==="visible"?(ae=!1,z&&P==!1&&(d==null||d.play()),i.linvel().z>3&&t.userData.onGround&&z&&P==!1&&(r==null||r.play()),!k&&T&&P==!1&&((e=ysdk.features.GameplayAPI)==null||e.start(),L.start(),L.elapsedTime=t.userData.time)):(ae=!0,(n=ysdk.features.GameplayAPI)==null||n.stop(),b!=null&&b.isPlaying&&b.pause(),d==null||d.stop(),r==null||r.stop(),P==!1&&!k&&T&&(t.userData.time=L.getElapsedTime(),L.stop()))});
