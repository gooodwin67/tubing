import{C as Le,S as mt,a as yt,F as _t,H as ht,b as St,D as gt,c as bt,A as Dt,P as wt,W as ft,G as Je,V as x,B as Q,R as Ae,d as xt,e as vt,f as ue}from"./three-Dhj7f3wh.js";import{O as p}from"./@dimforge-D3Mqfikn.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();function je(){let e=window.matchMedia||window.msMatchMedia;return e?e("(pointer:coarse)").matches:!1}function Ge(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}function $(e){const t=e/1e3,n=Math.floor(t),r=Math.floor((t-n)*1e3),a=Math.floor(n/60),l=n%60;return`${String(a).padStart(2,"0")}:${String(l).padStart(2,"0")}.${String(r).padStart(3,"0")}`}let W=document.querySelector(".main_load"),Ne=document.querySelector(".main_menu"),We=document.querySelector(".select_level"),pe=document.querySelectorAll(".select_level .level_shadow"),qt=document.querySelector(".select_tube"),Ct=document.querySelector(".finish_window"),Lt=document.querySelector(".finish_you_time .finish_you_time_time"),Ve=document.querySelector(".boom_window"),me=document.querySelector(".main_record"),At=document.querySelectorAll("body>.overlay"),zt=document.querySelector(".startButton"),kt=document.querySelectorAll(".load_level_wrap .btn_lev"),Ke=document.querySelectorAll(".load_level_wrap .level_time"),Ue=document.querySelectorAll(".load_tubes_wrap>div"),ye=document.querySelectorAll(".language_block img"),Ye=[],Qe=[],ne=0,$e=document.querySelector(".times"),ze=document.querySelector(".current_time"),Xe=document.querySelector(".best_time"),Et=document.querySelector(".finish_window .finish_again"),Tt=document.querySelector(".finish_window .finish_in_menu"),Rt=document.querySelector(".boom_window .finish_again"),Mt=document.querySelector(".boom_window .finish_in_menu"),Ze=document.querySelector(".speed_block"),et=document.querySelector(".speed_block>.speed"),Bt=document.querySelector(".instr_check"),_e=document.querySelector(".load_percent");document.querySelector(".records_wrap>div");let ke=document.querySelector(".pause_button_wrap"),Ht=document.querySelector(".close_pause_button"),Pt=document.querySelector(".reset_button"),Ft=document.querySelector(".inmenu_button"),It=document.querySelector(".before_start"),Ot=document.querySelector(".instruction_start_btn"),Jt=document.querySelector(".menu_in_game_wrap"),Ee=document.querySelector(".start_time"),tt=document.querySelector(".start_time_wrap"),he=document.querySelector(".audio_button");window.oncontextmenu=function(e){return!1},ye.forEach((e,t)=>{e.addEventListener("click",()=>{ne!=t&&(ye.forEach(n=>{n.classList.remove("selected")}),e.classList.add("selected"),ne=t,ot(ne))})});function ot(e){e==0?(document.querySelector(".title_game").src="./images/title.png",document.querySelector(".startgame_title").textContent="\u043D\u0430\u0447\u0430\u0442\u044C \u0438\u0433\u0440\u0443",document.querySelector(".language_title").textContent="\u042F\u0437\u044B\u043A:",document.querySelectorAll(".level_text h2>span").forEach(t=>{t.textContent="\u0423\u0440\u043E\u0432\u0435\u043D\u044C"}),document.querySelectorAll(".leveltime_title").forEach(t=>{t.textContent="\u0412\u0440\u0435\u043C\u044F: "}),document.querySelectorAll(".load_tubes_wrap .selecttube_title").forEach(t=>{t.textContent="\u0422\u044E\u0431\u0438\u043D\u0433"}),document.querySelectorAll(".load_tubes_wrap .selecttubespeed_title").forEach(t=>{t.textContent="\u0421\u043A\u043E\u0440\u043E\u0441\u0442\u044C: "}),document.querySelectorAll(".load_tubes_wrap .selecttubecontrol_title").forEach(t=>{t.textContent="\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435: "}),document.querySelectorAll(".load_level_wrap .btn_lev").forEach(t=>{t.textContent="\u041D\u0430\u0447\u0430\u0442\u044C"}),document.querySelectorAll(".load_level_wrap .ad_res").forEach(t=>{t.textContent="\u041F\u0440\u043E\u043F\u0443\u0441\u0442\u0438\u0442\u044C"}),document.querySelector(".selecttubedesc_title").textContent="\u041F\u0440\u043E\u0445\u043E\u0434\u0438\u0442\u0435 \u0443\u0440\u043E\u0432\u043D\u0438, \u0447\u0442\u043E\u0431\u044B \u0440\u0430\u0437\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0442\u044E\u0431\u0438\u043D\u0433\u0438",document.querySelector(".menu_in_game_wrap_head").textContent="\u041F\u0430\u0443\u0437\u0430",document.querySelector(".close_pause_button").textContent="\u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C \u0438\u0433\u0440\u0443",document.querySelector(".reset_button").textContent="\u041D\u0430\u0447\u0430\u0442\u044C \u0437\u0430\u043D\u043E\u0432\u043E",document.querySelector(".inmenu_button").textContent="\u0412\u044B\u0439\u0442\u0438",document.querySelector(".finish_you_time_title").textContent="\u0412\u0430\u0448\u0435 \u0432\u0440\u0435\u043C\u044F: ",document.querySelector(".crash_title").textContent="\u0412\u044B \u0432\u0440\u0435\u0437\u0430\u043B\u0438\u0441\u044C",document.querySelector(".finish_title").textContent="\u0412\u044B \u043F\u0440\u0438\u0435\u0445\u0430\u043B\u0438",document.querySelectorAll(".finish_again").forEach(t=>{t.textContent="\u0415\u0449\u0435 \u0440\u0430\u0437"}),document.querySelectorAll(".finish_in_menu").forEach(t=>{t.textContent="\u0412\u044B\u0431\u043E\u0440 \u0443\u0440\u043E\u0432\u043D\u044F"}),document.querySelector(".current_time_title").textContent="\u0412\u0440\u0435\u043C\u044F",document.querySelector(".best_time_title").textContent="\u041B\u0443\u0447\u0448\u0435\u0435 \u0432\u0440\u0435\u043C\u044F",document.querySelector(".speed_title").textContent="\u041A\u041C/\u0427",document.querySelector(".instruction_start_btn").textContent="\u0421\u0422\u0410\u0420\u0422",document.querySelector(".instr-disabled span").textContent="\u0411\u043E\u043B\u044C\u0448\u0435 \u043D\u0435 \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C",document.querySelector(".desktop_instr").innerHTML=`<h2>\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435</h2>
    <span>\u0411\u044B\u0441\u0442\u0440\u043E \u043D\u0430\u0436\u0438\u043C\u0430\u0439\u0442\u0435 <span class='button_active'>W</span> \u0438\u043B\u0438 <span class='button_active'>\u2191</span> \u0447\u0442\u043E\u0431\u044B \u0440\u0430\u0437\u043E\u0433\u043D\u0430\u0442\u044C\u0441\u044F \u0434\u043E \u0441\u0442\u0430\u0440\u0442\u043E\u0432\u043E\u0439 \u043E\u0442\u043C\u0435\u0442\u043A\u0438</span>
    <span>\u041A\u043B\u0430\u0432\u0438\u0448\u0430\u043C\u0438 <span>\u2190</span> <span>\u2192</span> \u0438\u043B\u0438 <span>A</span> <span>D</span> \u0443\u043F\u0440\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u0442\u044E\u0431\u0438\u043D\u0433\u043E\u043C</span>`,document.querySelector(".mobile_instr div").innerHTML=`<span>\u0411\u044B\u0441\u0442\u0440\u043E \u043D\u0430\u0436\u0438\u043C\u0430\u0439\u0442\u0435 \u043D\u0430 \u0437\u043E\u043D\u0443 <span> \u2191 </span> \u0447\u0442\u043E\u0431\u044B \u0440\u0430\u0437\u043E\u0433\u043D\u0430\u0442\u044C\u0441\u044F \u0434\u043E \u0441\u0442\u0430\u0440\u0442\u043E\u0432\u043E\u0439 \u043E\u0442\u043C\u0435\u0442\u043A\u0438</span>
    <span>\u041D\u0430\u0436\u0438\u043C\u0430\u044F \u043D\u0430 \u0437\u043E\u043D\u044B <span> \u2190 </span> \u0438 <span> \u2192 </span> \u0443\u043F\u0440\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u0442\u044E\u0431\u0438\u043D\u0433\u043E\u043C</span>`,document.querySelector(".sci-fi-loader strong").textContent="\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430",document.querySelector(".main_record_title").textContent="\u041C\u043E\u0435 \u043E\u0431\u0449\u0435\u0435 \u0432\u0440\u0435\u043C\u044F: ",E==0&&(document.querySelector(".main_record").textContent="\u041F\u0440\u043E\u0439\u0434\u0438\u0442\u0435 \u0432\u0441\u0435 \u0443\u0440\u043E\u0432\u043D\u0438, \u0447\u0442\u043E\u0431\u044B \u043F\u043E\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u0440\u0435\u043A\u043E\u0440\u0434"),document.querySelector(".records_wrap>p").textContent="\u041C\u0438\u0440\u043E\u0432\u043E\u0439 \u0440\u0435\u0439\u0442\u0438\u043D\u0433: "):(document.querySelector(".title_game").src="./images/title-en.png",document.querySelector(".startgame_title").textContent="start game",document.querySelector(".language_title").textContent="Language:",document.querySelectorAll(".level_text h2>span").forEach(t=>{t.textContent="Level"}),document.querySelectorAll(".leveltime_title").forEach(t=>{t.textContent="Time: "}),document.querySelectorAll(".load_tubes_wrap .selecttube_title").forEach(t=>{t.textContent="Tubing"}),document.querySelectorAll(".load_tubes_wrap .selecttubespeed_title").forEach(t=>{t.textContent="Speed: "}),document.querySelectorAll(".load_tubes_wrap .selecttubecontrol_title").forEach(t=>{t.textContent="Control: "}),document.querySelector(".selecttubedesc_title").textContent="Complete the levels to unlock the tubings",document.querySelector(".menu_in_game_wrap_head").textContent="Pause",document.querySelector(".close_pause_button").textContent="Continue",document.querySelector(".reset_button").textContent="Start again",document.querySelector(".inmenu_button").textContent="Exit to levels",document.querySelector(".finish_you_time_title").textContent="You time: ",document.querySelector(".crash_title").textContent="You crashed",document.querySelector(".finish_title").textContent="You finished",document.querySelectorAll(".finish_again").forEach(t=>{t.textContent="Again"}),document.querySelectorAll(".finish_in_menu").forEach(t=>{t.textContent="Select Level"}),document.querySelector(".current_time_title").textContent="Time",document.querySelector(".best_time_title").textContent="Best time",document.querySelector(".speed_title").textContent="KM/H",document.querySelector(".instruction_start_btn").textContent="START",document.querySelector(".instr-disabled span").textContent="Don't show again",document.querySelector(".desktop_instr").innerHTML=`<h2>Instructions</h2>
    <span>Quickly press <span class='button_active'>W</span> or <span class='button_active'>\u2191</span> to accelerate to the starting point</span>
    <span>Use <span>\u2190</span> <span>\u2192</span> or <span>A</span> <span>D</span> keys to control the tubing</span>`,document.querySelector(".mobile_instr div").innerHTML=`<span>Quickly press on zone <span> \u2191 </span> to accelerate to the starting point</span>
    <span>By taps on zones <span> \u2190 </span> and <span> \u2192 </span> control the tubing</span>`,document.querySelector(".sci-fi-loader strong").textContent="Loading ",document.querySelector(".main_record_title").textContent="My total time: ",E==0&&(document.querySelector(".main_record").textContent="Complete all the levels to set a record"),document.querySelector(".records_wrap>p").textContent="World Ranking: ",document.querySelectorAll(".load_level_wrap .btn_lev").forEach(t=>{t.textContent="Start"}),document.querySelectorAll(".load_level_wrap .ad_res").forEach(t=>{t.textContent="Skip"}))}document.querySelectorAll(".load_level_wrap .ad_res").forEach((e,t)=>{e.addEventListener("click",async()=>{z.ads.isRewardedAvailable&&z.ads.showRewardedVideo(),z.ads.on("rewarded:start",()=>{console.log("Video ad open."),be=!0,i!=null&&i.isPlaying&&i.stop()}),z.ads.on("rewarded:close",n=>{console.log("Video ad closed."),i!=null&&!i.isPlaying&&v&&i.play(),be=!1}),z.ads.on("rewarded:reward",async()=>{console.log("Rewarded! "+t),S(W),_.levelsTimes["time"+(t+1)]="120.111",X=Object.keys(_.levelsTimes).length,localStorage.setItem("playerData",JSON.stringify(_)),await Y(),await re()})})}),kt.forEach((e,t)=>{e.addEventListener("click",async()=>{t+1<=Oe+1&&(J=t+1,Ue.forEach((n,r)=>{y[r].levels.includes(J)?(n.classList.remove("disabledTube"),y[r].canInLevel=!0):(n.classList.add("disabledTube"),y[r].canInLevel=!1)}),S(W),await le(!1,!0),S(qt))})}),Ue.forEach((e,t)=>{e.addEventListener("click",()=>{y[t].canInLevel&&(h=t,S(0),ae())})});function ae(){if(!_.canStart)S(It),M?document.querySelector(".mobile_instr").classList.remove("hidden_instr"):document.querySelector(".desktop_instr").classList.remove("hidden_instr");else{$e.classList.remove("hidden_block"),Ze.classList.remove("hidden_block"),Se[h].position.copy(c.translation());let e=0;Me=!0,M&&document.querySelector(".instr-mobile-ingame").classList.remove("hidden_block"),M&&document.querySelector(".anim_tap_top").classList.remove("hidden_block");let t=setInterval(n=>{b!=null&&!b.isPlaying&&v&&!se&&e==0&&b.play(),tt.classList.remove("hidden_block"),se||e++,e==2&&M&&document.querySelector(".instr-mobile-ingame").classList.add("hidden_block"),e==4?(Me=!1,ne==0?Ee.textContent="\u0421\u0422\u0410\u0420\u0422":Ee.textContent="GO",P=!0,ke.classList.remove("hidden_block"),clearInterval(t),setTimeout(()=>{tt.classList.add("hidden_block"),b==null||b.stop()},1500)):Ee.textContent=4-e},1e3)}}Ot.addEventListener("click",()=>{_.canStart=!0,S(0),ae()}),he.addEventListener("click",()=>{v==!0?(he.classList.add("audio_off"),i!=null&&i.isPlaying&&i.stop(),d!=null&&d.isPlaying&&d.stop(),b!=null&&b.isPlaying&&b.stop(),v=!1):(he.classList.remove("audio_off"),i!=null&&!i.isPlaying&&i.play(),c.linvel().z>3&&o.userData.onGround&&!O&&(d==null||d.play()),v=!0)}),zt.addEventListener("click",()=>{M=je(),Ie=Ge(),Ie&&he.classList.add("hidden_block"),ne==0?ge=at:ge=st,document.querySelector(".audio_button_wrap").classList.remove("hidden_block"),i!=null&&v&&i.play(),Ne.classList.add("hidden_block"),We.classList.remove("hidden_block")});function S(e){At.forEach(t=>{t.classList.add("hidden_block")}),e!=0&&e.classList.remove("hidden_block")}Et.addEventListener("click",async()=>{S(W),await Y(),await le(!0,!0),S(0),ae()}),Rt.addEventListener("click",async()=>{S(W),await Y(),await le(!0,!0),S(0),ae()}),Pt.addEventListener("click",async()=>{await Y(),await le(!0,!0),S(0),ae()}),Tt.addEventListener("click",async()=>{S(W),await Y(),await re(),z.ads.isFullscreenAvailable&&z.ads.showFullscreen(),z.ads.on("fullscreen:start",()=>{i!=null&&i.isPlaying&&i.stop()}),z.ads.on("fullscreen:close",e=>{i!=null&&!i.isPlaying&&v&&i.play()})}),Mt.addEventListener("click",async()=>{S(W),await Y(),await re()}),Ft.addEventListener("click",async()=>{S(W),await Y(),await re()}),ke.addEventListener("click",()=>{Me==!1&&P&&!T&&(S(Jt),o.userData.time=A.getElapsedTime(),A.stop(),document.querySelector(".audio_button_wrap").classList.add("hidden_block"),d==null||d.stop(),i==null||i.stop(),O=!0)}),Ht.addEventListener("click",()=>{S(0),A.start(),A.elapsedTime=o.userData.time,document.querySelector(".audio_button_wrap").classList.remove("hidden_block"),v&&(i==null||i.play()),c.linvel().z>3&&o.userData.onGround&&v&&(d==null||d.play()),O=!1}),Bt.onchange=function(){this.checked?(_.canStart=!0,localStorage.setItem("playerData",JSON.stringify(_))):(_.canStart=!1,localStorage.setItem("playerData",JSON.stringify(_)))};let m,Te=!0;performance.now();let J=0,O=!1,v=!0,E=0,V=0,X=0,nt=!1,o,c,Re,Me=!1,Se=[],h=0,j,ge,at,st,se=!1,be=!1,Be,T;const y=[{hSpeed:10,maxHSpeed:.08,stepSpeed:1,nowSpeed:0,maxSpeed:26,resetHAngle:!1,levels:[1,2,3,4,5,6,7,8,9],canInLevel:!1},{hSpeed:12,maxHSpeed:.1,stepSpeed:2,nowSpeed:0,maxSpeed:38,resetHAngle:!1,levels:[4,5,6,7,8,9],canInLevel:!1},{hSpeed:14,maxHSpeed:.12,stepSpeed:2,nowSpeed:0,maxSpeed:44,resetHAngle:!0,levels:[7,8,9],canInLevel:!1}];let d,i,R,b,it,q=[],Z=new x,jt=new Ae,P=!1,He=!1,ee,rt,lt,g,F,I,C,L,De,we,fe,te,oe,Pe,K=[],xe=[],Fe=[],D,M=je(),Ie=Ge(),Gt=new Le,A=new Le,ve=0,ct=1/60,U=0,B=0,Oe=2,_;const dt=new Ae,Nt=new x(0,-1,0),u=new mt;u.background=new yt(14479094),u.fog=new _t(u.background,1,300);const ie=new ht(16777215,16777215,2);ie.color.setHSL(.6,1,.6),ie.groundColor.setHSL(.095,1,.75),ie.position.set(0,100,0),new St(ie,10);const qe=new gt(16777215,3);qe.position.set(1,2,.2),qe.position.multiplyScalar(120),new bt(qe,10),new Dt(11184810,1);const f=new wt(85,document.body.offsetWidth/document.body.offsetHeight,.1,310);f.position.set(0,4,-10);const G=new ft({antialias:!1});G.setSize(document.body.offsetWidth,document.body.offsetHeight),document.body.appendChild(G.domElement),G.shadowMap.enabled=!1,window.addEventListener("resize",Wt,!1);function Wt(){M?(f.aspect=document.body.offsetWidth/document.body.offsetHeight,f.updateProjectionMatrix(),G.setSize(innerWidth,innerHeight)):(f.aspect=document.body.offsetWidth/document.body.offsetHeight,f.updateProjectionMatrix(),G.setSize(document.body.offsetWidth,document.body.offsetHeight))}async function Vt(){localStorage.getItem("playerData")?(_=JSON.parse(localStorage.getItem("playerData")),ye.forEach(e=>{e.classList.remove("selected")}),X=Object.keys(_.levelsTimes).length,X==pe.length&&(E=0,Object.values(_.levelsTimes).forEach(e=>{E+=parseFloat(e)}),me.textContent=$(Math.round(E*1e3)),me.classList.add("main_record_green"))):(_={levelsTimes:{},canStart:!1},localStorage.setItem("playerData",JSON.stringify(_))),JSON.stringify(_),console.log(_),Oe=0,pe.forEach((e,t)=>{t<Object.keys(_.levelsTimes).length+1&&(Oe++,e.classList.remove("level_disabled"))}),Ke.forEach((e,t,n)=>{_.levelsTimes["time"+(t+1)]!=null?(e.childNodes[2].textContent=_.levelsTimes["time"+(t+1)],document.querySelectorAll(".load_level_wrap .ad_res").forEach((r,a)=>{(t==a||a==Ke.length-1)&&r.classList.add("not_vis")})):e.childNodes[2].textContent="00.000"})}async function Kt(){A=new Le,u.add(qe),u.add(ie),B=0,await p.init(),m=new p.World(new p.Vector3(0,-9.81,0)),await new Je().loadAsync("models/map-menu.glb",onprogress=l=>{let w=Math.min(Math.round(l.loaded/l.total*100),100);_e.textContent=w+"%"}).then(l=>{const w=l.scene;_e.textContent="0",w.traverse(s=>{if(s.name=="player")o=s.clone(),o.userData.vertices=o.geometry.attributes.position.array,o.userData.indices=o.geometry.index.array,o.material.transparent=!0,o.material.opacity=0,o.userData.mass=1,o.userData.playerBraking=!1,o.userData.hTransition=0,o.userData.currentSpeed=0,o.userData.boom=!1,o.userData.onStartArea=!0,o.userData.canBoostStep=!0,o.userData.time=0,o.userData.right=!1,o.userData.left=!1,o.userData.onGround=!1,o.userData.flying=!1,o.userData.origPosition=o.position,H(o),u.add(o);else if(s.name.includes("player-tube"))j=s.clone(),j.userData.startPosition=new x(j.position.x,j.position.y,j.position.z),Se[s.name.slice(-1)-1]=j,u.add(j);else if(s.name=="arrow_area")D=s.clone(),D.userData.hPos=0,u.add(D);else if(s.name.includes("ground"))new Q().setFromObject(s).getSize(new x),ee=s.clone(),ee.userData.mass=0,H(ee),K.push(ee),u.add(ee),s.name=="left_ground_wall"?rt=s.position:s.name=="right_ground_wall"&&(lt=s.position);else if(s.name.includes("wall")){new Q().setFromObject(s).getSize(new x);let k=s.clone();k.userData.mass=1,H(k),K.push(k),xe.push(k),u.add(k)}else if(s.name.includes("area")){let k=s.clone();u.add(k)}else s.name.includes("start_flag_en")?st=s.clone():s.name.includes("start_flag_ru")?at=s.clone():s.name.includes("itsmen_body")?(g=s.clone(),g.material.transparent=!0,g.material.opacity=0,u.add(g),H(g)):s.name.includes("itsmen_left_hand")?(F=s.clone(),F.material.transparent=!0,F.material.opacity=0,u.add(F),H(F)):s.name.includes("itsmen_right_hand")?(I=s.clone(),I.material.transparent=!0,I.material.opacity=0,u.add(I),H(I)):s.name.includes("itsmen_left_leg")?(C=s.clone(),C.material.transparent=!0,C.material.opacity=0,u.add(C),H(C)):s.name.includes("itsmen_right_leg")?(L=s.clone(),L.material.transparent=!0,L.material.opacity=0,u.add(L),H(L)):s.name.includes("qmen_body")?(De=s.clone(),u.add(De)):s.name.includes("qmen_left_hand")?(we=s.clone(),u.add(we)):s.name.includes("qmen_right_hand")?(fe=s.clone(),u.add(fe)):s.name.includes("qmen_left_leg")?(te=s.clone(),u.add(te)):s.name.includes("qmen_right_leg")&&(oe=s.clone(),u.add(oe))})}),u.traverse(function(l){l.material&&(l.material.needsUpdate=!0)}),await Vt();let e=p.JointData.spherical({x:.2,y:0,z:-.2},{x:-.4,y:0,z:0});m.createImpulseJoint(e,g.userData.body,F.userData.body,!0);let t=p.JointData.spherical({x:-.2,y:0,z:-.2},{x:.4,y:0,z:0});m.createImpulseJoint(t,g.userData.body,I.userData.body,!0);let n=p.JointData.spherical({x:.22,y:0,z:.5},{x:0,y:0,z:-.5});m.createImpulseJoint(n,g.userData.body,C.userData.body,!0);let r=p.JointData.spherical({x:-.22,y:0,z:.5},{x:0,y:0,z:-.5});m.createImpulseJoint(r,g.userData.body,L.userData.body,!0);let a=p.JointData.spherical({x:0,y:0,z:0},{x:0,y:.3,z:0});Pe=m.createImpulseJoint(a,g.userData.body,c,!0),He=!0}async function Ut(){u.add(ge),T=!1;const e=new Je,t="models/map"+J+".glb";await e.loadAsync(t,onprogress=n=>{let r=Math.min(Math.round(n.loaded/n.total*100),100);_e.textContent=r+"%"}).then(n=>{const r=n.scene;_e.textContent="0",r.traverse(a=>{if(a.name.includes("ground")){new Q().setFromObject(a).getSize(new x);let l=a.clone();l.userData.mass=0,l.name=a.name,H(l),K.push(l),u.add(l)}else if(a.name.includes("wall")){new Q().setFromObject(a).getSize(new x);let l=a.clone();l.userData.mass=1,H(l),K.push(l),xe.push(l),u.add(l)}else if(a.name.includes("moving_block")){const l=new Q().setFromObject(a).getSize(new x);let w=a.clone();w.userData.size=l,w.userData.mass=1,w.userData.raycaster=new Ae,w.userData.speed=-a.name.substr(a.name.indexOf("speed")+6),w.userData.direction=new x(w.userData.speed,0,0),Ye.push(w),H(w),xe.push(w),u.add(w)}else if(a.name.includes("area")){let l=a.clone();u.add(l)}else a.name.includes("finish_block")&&(Be=a.clone(),u.add(Be))})}),Xe.textContent=_.levelsTimes["time"+J]}async function Yt(){const e=new xt,t=new vt;await t.loadAsync("audio/slide.mp3").then(n=>{d=new ue(e),d.setBuffer(n),d.setLoop(!0),d.setRefDistance(400),d.setVolume(.7),o.add(d)}).catch(n=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0430\u0443\u0434\u0438\u043E:",n)}),await t.loadAsync("audio/around.mp3").then(n=>{i=new ue(e),i.setBuffer(n),i.setLoop(!0),i.setRefDistance(400),i.setVolume(1),i.error=!1,o.add(i)}).catch(n=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0430\u0443\u0434\u0438\u043E:",n)}),await t.loadAsync("audio/boom1.mp3").then(n=>{R=new ue(e),R.setBuffer(n),R.setLoop(!1),R.setRefDistance(400),R.setVolume(.3),R.error=!1,o.add(R)}).catch(n=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0430\u0443\u0434\u0438\u043E:",n)}),await t.loadAsync("audio/bip.mp3").then(n=>{b=new ue(e),b.setBuffer(n),b.setLoop(!1),b.setRefDistance(400),b.setVolume(.3),b.error=!1,o.add(b)}).catch(n=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0430\u0443\u0434\u0438\u043E:",n)})}let z;async function re(){await le(!0,!1),Te?(console.log("000"),window.onGPInit=async e=>{console.log("001"),await e.player.ready,console.log("002"),e.ads.isPreloaderAvailable&&e.ads.canShowFullscreenBeforeGamePlay&&await e.ads.showPreloader(),e.ads.isStickyAvailable&&e.ads.showSticky(),z=e,nt=!0,e.ads.isRewardedAvailable||document.querySelectorAll(".load_level_wrap .ad_res").forEach((N,ce)=>{N.classList.add("not_vis")}),console.log(111);const t=await e.leaderboard.fetch({orderBy:["score"],order:"ASC",limit:4,withMe:"last",showNearest:0});console.log(t);const{players:n,fields:r,topPlayers:a,abovePlayers:l,belowPlayers:w,player:s}=t;let k=0;console.log(222),t.players.forEach((N,ce)=>{N.score!=0&&(k++,s.id==n[ce].id?(V=N.score,document.querySelector(".records_wrap>div").innerHTML=document.querySelector(".records_wrap>div").innerHTML+'<p class = "main_record_green">'+k+". "+$(N.score)+"</p>"):document.querySelector(".records_wrap>div").innerHTML=document.querySelector(".records_wrap>div").innerHTML+"<p>"+k+". "+$(N.score)+"</p>")}),V=e.player.get("score"),console.log(V),console.log(333),ye[0].classList.add("selected"),ot(0),S(Ne),Te=!1}):S(We)}re();async function le(e,t){e&&await Kt(),t&&await Ut(),Te&&!Ie&&Yt()}async function Y(){for(P=!1,He=!1,B=0,o.userData.time=0,o.userData.boom=!1,y.forEach(e=>{e.nowSpeed=0}),K=[],xe=[],q=[],ke.classList.add("hidden_block"),$e.classList.add("hidden_block"),Ze.classList.add("hidden_block"),document.querySelector(".audio_button_wrap").classList.remove("hidden_block"),A.start(),A.elapsedTime=o.userData.time,O=!1,o.userData.currentSpeed=0,et.textContent=o.userData.currentSpeed,B=0,ze.textContent=B;u.children.length>0;){let e=u.children[0];e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(t=>t.dispose()):e.material.dispose()),u.remove(e)}T=!1,i!=null&&v&&!se&&!be&&i.play()}function Qt(){if(He&&!T&&(d!=null&&v&&(c.linvel().z>3&&o.userData.onGround?d.isPlaying||d.play():d.isPlaying&&d.stop()),M?o.userData.boom?(f.lookAt(g.position),d==null||d.stop()):(f.lookAt(new x(f.position.x,o.position.y,o.position.z+5)),f.position.y=o.position.y+5,f.position.z=o.position.z-3):o.userData.boom?(j.position.y>0&&f.lookAt(g.position),d==null||d.stop()):(f.lookAt(new x(f.position.x,o.position.y,o.position.z+5)),f.position.y=o.position.y+4,f.position.z=o.position.z-4),D.position.set(o.position.x,o.position.y,o.position.z+5)),P){T?(S(Ct),d==null||d.stop()):(B=A.getElapsedTime().toFixed(3),ze.textContent=B,Xt(),$t()),o.position.x>rt.x-o.userData.size.x/1.3&&(D.position.x=o.position.x,o.userData.hTransition=-.4),o.position.x<lt.x+o.userData.size.x/1.3&&(D.position.x=o.position.x,o.userData.hTransition=.4);let e=new p.EventQueue(!0);m.step(e),Se[h].position.copy(c.translation()),Se[h].quaternion.copy(c.rotation()),De.position.copy(g.position),De.rotation.copy(g.rotation),we.position.copy(F.position),we.rotation.copy(F.rotation),fe.position.copy(I.position),fe.rotation.copy(I.rotation),te.position.copy(C.position),te.rotation.copy(C.rotation),oe.position.copy(L.position),oe.rotation.copy(L.rotation);for(let t=0,n=q.length;t<n;t++)q[t][0].position.copy(q[t][1].translation()),q[t][0].quaternion.copy(q[t][1].rotation());e.drainCollisionEvents((t,n,r)=>{Fe.forEach((a,l)=>{c.handle==t&&a.handle==n&&!T?c.linvel().z<15&&o.userData.boom==!1&&(R!=null&&v&&R.play(),m.removeImpulseJoint(Pe),g.userData.body.applyImpulse({x:5,y:5,z:5},!0),g.userData.body.setEnabledRotations(!0),Re.setFriction(20),setTimeout(()=>{P=!1,S(Ve)},3e3),o.userData.boom=!0):c.handle==t&&!T&&c.linvel().z<15&&o.position.y<5&&o.userData.boom==!1&&(R!=null&&v&&R.play(),m.removeImpulseJoint(Pe),g.userData.body.applyImpulse({x:5,y:5,z:5},!0),g.userData.body.setEnabledRotations(!0),Re.setFriction(20),o.userData.boom=!0,setTimeout(()=>{P=!1,S(Ve)},3e3))})})}}G.setAnimationLoop(()=>{ve+=Gt.getDelta(),ve>ct&&!O&&(Qt(),G.render(u,f),ve=ve%ct)}),document.addEventListener("touchend",Zt),document.addEventListener("touchstart",ut),document.addEventListener("touchmove",ut),window.addEventListener("keydown",eo),window.addEventListener("keyup",to);function $t(){Ye.forEach((e,t)=>{let n=e,r=Qe[t];r.setLinvel(n.userData.direction,!0),r.setAngvel({x:n.userData.direction.z,y:n.userData.direction.y,z:-n.userData.direction.x},!0);const a=n.userData.direction;n.userData.raycaster.set(new x(n.position.x,.4,n.position.z),a.clone().normalize());const l=n.userData.raycaster.intersectObjects(K);l.length>0&&l[0].distance<n.userData.size.x/2&&(n.userData.direction.x=n.userData.direction.x*-1)})}async function Xt(){if(o.position.z>Be.position.z&&!o.userData.boom){if(B=A.getElapsedTime().toFixed(3),ze.textContent=B,T=!0,Lt.textContent=B,_.levelsTimes["time"+J]!=null?U=parseFloat(_.levelsTimes["time"+J]):U=0,B<U||U==0){if(U=B,Xe.textContent=U,_.levelsTimes["time"+J]=U,console.log(_.levelsTimes["time"+J]),X=Object.keys(_.levelsTimes).length,console.log(X),console.log(pe.length),X==pe.length&&(E=0,Object.values(_.levelsTimes).forEach(a=>{E+=parseFloat(a)}),me.textContent=$(Math.round(E*1e3)),me.classList.add("main_record_green"),console.log(V),console.log(Math.round(E*1e3)),nt&&Math.round(E*1e3)<V||V==0)){console.log(Math.round(E*1e3)),z.player.set("score",Math.round(E*1e3)),await z.player.sync();const a=await z.leaderboard.fetch({orderBy:["score"],order:"ASC",limit:3,withMe:"last",showNearest:0}),{players:l,fields:w,topPlayers:s,abovePlayers:k,belowPlayers:N,player:ce}=a;console.log(a);let Ce=0;document.querySelector(".records_wrap>div").innerHTML="",a.players.forEach((de,pt)=>{de.score!=0&&(Ce++,ce.id==l[pt].id?(V=de.score,document.querySelector(".records_wrap>div").innerHTML=document.querySelector(".records_wrap>div").innerHTML+'<p class = "main_record_green">'+Ce+". "+$(de.score)+"</p>",console.log("123123123")):document.querySelector(".records_wrap>div").innerHTML=document.querySelector(".records_wrap>div").innerHTML+"<p>"+Ce+". "+$(de.score)+"</p>")})}localStorage.setItem("playerData",JSON.stringify(_))}o.position.z=0}D.position.x+=o.userData.hTransition;const e=new x().subVectors(c.translation(),D.position).normalize(),t=c.linvel(),n=new x(e.x*-y[h].hSpeed,t.y,e.z*-y[h].nowSpeed);c.translation().y<100&&c.translation().y>=20&&(y[h].nowSpeed+=.05,c.rotation().x<.04&&c.setRotation({w:c.rotation().w,x:.04,y:c.rotation().y,z:c.rotation().z})),c.translation().y<20&&c.translation().y>1&&c.lockRotations(!0,!0,!0,!0),c.setLinvel(n,!0),D.lookAt(D.position.x-(o.position.x-D.position.x),D.position.y-(o.position.y-D.position.y),D.position.z-(o.position.z-D.position.z)),c.setRotation({w:D.quaternion.w,x:c.rotation().x,y:D.quaternion.y,z:c.rotation().z}),g.userData.body.setRotation({w:D.quaternion.w,x:c.rotation().x,y:D.quaternion.y,z:c.rotation().z}),(te.rotation.y>0||te.rotation.y<0)&&C.userData.body.setRotation({w:C.userData.body.rotation().w,x:C.userData.body.rotation().x,y:0,z:C.userData.body.rotation().z}),(oe.rotation.y>0||oe.rotation.y<0)&&L.userData.body.setRotation({w:L.userData.body.rotation().w,x:L.userData.body.rotation().x,y:0,z:L.userData.body.rotation().z}),dt.set(o.position,Nt);const r=dt.intersectObjects(K);r.length>0&&(r[0].distance<.4?(o.userData.flying=!1,o.userData.onGround=!0):(o.userData.onGround=!1,o.userData.flying=!0)),c.linvel().z>0?o.userData.currentSpeed=c.linvel().z.toFixed(0):o.userData.currentSpeed=0,et.textContent=o.userData.currentSpeed,o.userData.left&&o.userData.onGround&&!o.userData.onStartArea&&(o.userData.hTransition<5&&(o.userData.hTransition+=y[h].maxHSpeed),y[h].nowSpeed-=.009),o.userData.right&&o.userData.onGround&&!o.userData.onStartArea&&(o.userData.hTransition>-5&&(o.userData.hTransition-=y[h].maxHSpeed),y[h].nowSpeed-=.009),y[h].resetHAngle&&!o.userData.left&&!o.userData.right&&(o.userData.hTransition<-y[h].maxHSpeed?o.userData.hTransition+=y[h].maxHSpeed:o.userData.hTransition>y[h].maxHSpeed?o.userData.hTransition-=y[h].maxHSpeed:o.userData.hTransition=0),o.position.z>ge.position.z?(o.userData.onStartArea==!0&&M&&document.querySelector(".anim_tap_top").classList.add("hidden_block"),o.userData.onStartArea==!0&&M&&document.querySelector(".anim_tap_left").classList.remove("hidden_block"),o.userData.onStartArea==!0&&M&&document.querySelector(".anim_tap_right").classList.remove("hidden_block"),o.userData.onStartArea==!0&&M&&setTimeout(()=>{document.querySelector(".anim_tap_left").classList.add("hidden_block"),document.querySelector(".anim_tap_right").classList.add("hidden_block")},2e3),o.userData.onStartArea=!1):o.userData.onStartArea=!0}function ut(e){if(o.userData.onGround){e=e.changedTouches[0];var t=G.domElement.getBoundingClientRect();Z.x=(e.clientX-t.left)/t.width*2-1,Z.y=-((e.clientY-t.top)/t.height)*2+1,jt.setFromCamera(Z,f),Z.y>0&&o.userData.canBoostStep&&P&&o.userData.onStartArea&&c.linvel().z<y[h].maxSpeed&&c.linvel().y<5&&c.linvel().y>-5&&!T&&y[h].nowSpeed<y[h].maxSpeed&&(y[h].nowSpeed+=y[h].stepSpeed),o.userData.canBoostStep=!1,Z.y<.5&&(Z.x>0?(o.userData.left=!1,o.userData.right=!0):(o.userData.right=!1,o.userData.left=!0))}}function Zt(e){o.userData.right=!1,o.userData.left=!1,o.userData.canBoostStep=!0}function eo(e){switch(e.code){case"KeyW":case"ArrowUp":o.userData.canBoostStep&&P&&o.userData.onStartArea&&c.linvel().z<y[h].maxSpeed&&c.linvel().y<5&&c.linvel().y>-5&&!T&&y[h].nowSpeed<y[h].maxSpeed&&(y[h].nowSpeed+=y[h].stepSpeed),o.userData.canBoostStep=!1;break;case"KeyS":case"ArrowDown":break;case"KeyA":case"ArrowLeft":o.userData.left=!0;break;case"KeyD":case"ArrowRight":o.userData.right=!0;break}}function to(e){switch(e.code){case"KeyW":case"ArrowUp":o.userData.canBoostStep=!0;break;case"KeyS":case"ArrowDown":break;case"KeyA":case"ArrowLeft":o.userData.left=!1;break;case"KeyD":case"ArrowRight":o.userData.right=!1;break}}function H(e){let t,n;const r=e.rotation.clone();e.rotation.set(0,0,0);const a=new Q().setFromObject(e).getSize(new x);if(e.rotation.copy(r),e.name.includes("player")?(o.userData.size=a,o.userData.orgRotation=r,t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!1,!1).setLinearDamping(0).setAngularDamping(2)),n=p.ColliderDesc.cuboid(a.x/5,a.y/1.5,a.z/3).setMass(e.userData.mass).setRestitution(0).setFriction(0),c=t,Re=n,n.setActiveEvents(p.ActiveEvents.COLLISION_EVENTS),m.createCollider(n,t),o.userData.handle=c.handle,q.push([e,t,e.id])):e.name.includes("ground")&&(t=m.createRigidBody(p.RigidBodyDesc.fixed().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0)),n=p.ColliderDesc.cuboid(a.x/2,a.y/2,a.z/2).setMass(e.userData.mass).setRestitution(0).setFriction(0),m.createCollider(n,t),it=t,ee.userData.handle=it.handle,q.push([e,t,e.id])),e.name.includes("wall")){t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!0,!1).setLinearDamping(0)),n=p.ColliderDesc.cuboid(a.x/2,a.y/2,a.z/2).setMass(e.userData.mass*10).setRestitution(0).setFriction(40);let l=m.createCollider(n,t);Fe.push(l),q.push([e,t,e.id])}if(e.name.includes("moving_block")){t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!0,!0,!0).setLinearDamping(0)),n=p.ColliderDesc.ball(a.x/2).setMass(e.userData.mass*10).setRestitution(0).setFriction(20);let l=t;Qe.push(l);let w=m.createCollider(n,t);Fe.push(w),q.push([e,t,e.id])}e.name.includes("itsmen_body")&&(t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!1,!0).setLinearDamping(0).setAngularDamping(0)),n=p.ColliderDesc.cuboid(a.x/2,a.y/2,a.z/2).setMass(0).setRestitution(0).setFriction(0).setDensity(2),g.userData.body=t,g.userData.collider=n,m.createCollider(n,t),q.push([e,t,e.id])),e.name.includes("itsmen_left_hand")&&(t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),n=p.ColliderDesc.capsule(a.z/2,a.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),F.userData.body=t,F.userData.collider=n,m.createCollider(n,t),q.push([e,t,e.id])),e.name.includes("itsmen_right_hand")&&(t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),n=p.ColliderDesc.capsule(a.z/2,a.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),I.userData.body=t,I.userData.collider=n,m.createCollider(n,t),q.push([e,t,e.id])),e.name.includes("itsmen_left_leg")&&(t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),n=p.ColliderDesc.capsule(a.z/2,a.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),C.userData.body=t,C.userData.collider=n,m.createCollider(n,t),q.push([e,t,e.id])),e.name.includes("itsmen_right_leg")&&(t=m.createRigidBody(p.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),n=p.ColliderDesc.capsule(a.z/2,a.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),L.userData.body=t,L.userData.collider=n,m.createCollider(n,t),q.push([e,t,e.id]))}document.addEventListener("visibilitychange",function(){document.visibilityState==="visible"?(se=!1,v&&O==!1&&!be&&(i==null||i.play()),c.linvel().z>3&&o.userData.onGround&&v&&O==!1&&(d==null||d.play()),!T&&P&&O==!1&&(A.start(),A.elapsedTime=o.userData.time)):(se=!0,b!=null&&b.isPlaying&&b.stop(),i==null||i.stop(),d==null||d.stop(),O==!1&&!T&&P&&(o.userData.time=A.getElapsedTime(),A.stop()))});
