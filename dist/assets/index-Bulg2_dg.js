import{C as le,S as Pe,a as Ve,F as Ue,H as Xe,b as Ye,D as Qe,c as Ze,A as $e,P as et,d as tt,W as at,e as ot,V as f,R as ce,G as _e,B as W,f as nt,g as it,h as ue}from"./three-C9P8UM71.js";import{O as c}from"./@dimforge-D3Mqfikn.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function a(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(r){if(r.ep)return;r.ep=!0;const n=a(r);fetch(r.href,n)}})();function pe(e,a){e.geometry.computeBoundingBox(),a.forEach(function(n,s,w){n.children.length>0?n.children.forEach(function(i,L,Ke){i.geometry.computeBoundingBox()}):n.geometry.computeBoundingBox()}),e.updateMatrixWorld(),a.forEach(function(n,s,w){n.updateMatrixWorld()});let o=e.geometry.boundingBox.clone();o.applyMatrix4(e.matrixWorld);var r=!1;return a.forEach(function(n,s,w){if(n.children.length>0)n.children.forEach(function(i,L,Ke){let ve=i.geometry.boundingBox.clone();ve.applyMatrix4(i.matrixWorld),o.intersectsBox(ve)&&(r=i)});else{let i=n.geometry.boundingBox.clone();i.applyMatrix4(n.matrixWorld),o.intersectsBox(i)&&(r=n)}}),r}function ze(){let e=window.matchMedia||window.msMatchMedia;return e?e("(pointer:coarse)").matches:!1}let N=document.querySelector(".main_load"),Le=document.querySelector(".main_menu"),Re=document.querySelector(".select_level"),st=document.querySelector(".select_tube"),rt=document.querySelector(".finish_window"),dt=document.querySelector(".finish_you_time span"),ke=document.querySelector(".boom_window"),lt=document.querySelectorAll("body>.overlay"),ct=document.querySelector(".startButton"),ut=document.querySelectorAll(".load_level_wrap>div"),pt=document.querySelectorAll(".load_level_wrap .level_time"),qe=document.querySelectorAll(".load_tubes_wrap>div"),Ee=[],Ce=[],Be=document.querySelector(".times"),me=document.querySelector(".current_time"),Ae=document.querySelector(".best_time"),mt=document.querySelector(".finish_window .finish_again"),yt=document.querySelector(".finish_window .finish_in_menu"),Dt=document.querySelector(".boom_window .finish_again"),ht=document.querySelector(".boom_window .finish_in_menu"),Te=document.querySelector(".speed_block"),Ie=document.querySelector(".speed_block>.speed"),wt=document.querySelector(".shadow_check"),gt=document.querySelector(".instr_check"),$=document.querySelector(".load_percent"),ye=document.querySelector(".pause_button_wrap"),ft=document.querySelector(".close_pause_button"),St=document.querySelector(".reset_button"),bt=document.querySelector(".inmenu_button"),xt=document.querySelector(".before_start"),vt=document.querySelector(".instruction_start_btn"),_t=document.querySelector(".menu_in_game_wrap"),Me=document.querySelector(".start_time"),Fe=document.querySelector(".start_time_wrap"),zt=document.querySelector(".clear_rec");zt.addEventListener("click",()=>{localStorage.clear()}),ut.forEach((e,a)=>{e.addEventListener("click",async()=>{M=a+1,qe.forEach((o,r)=>{u[r].levels.includes(M)?(o.classList.remove("disabledTube"),u[r].canInLevel=!0):(o.classList.add("disabledTube"),u[r].canInLevel=!1)}),D(N),await Z(!1,!0),D(st)})}),qe.forEach((e,a)=>{e.addEventListener("click",()=>{u[a].canInLevel&&(m=a,D(0),Y())})});function Y(){if(!g.canStart)D(xt),ie?document.querySelector(".mobile_instr").classList.remove("hidden_instr"):document.querySelector(".desktop_instr").classList.remove("hidden_instr");else{Be.classList.remove("hidden_block"),Te.classList.remove("hidden_block"),ee[m].position.copy(d.translation());let e=3;he=!0;let a=setInterval(o=>{Fe.classList.remove("hidden_block"),e++,e==4?(he=!1,Me.textContent="GO",C=!0,ye.classList.remove("hidden_block"),clearInterval(a),setTimeout(()=>{Fe.classList.add("hidden_block")},600)):Me.textContent=4-e},1e3)}}vt.addEventListener("click",()=>{g.canStart=!0,D(0),Y()}),ct.addEventListener("click",()=>{ie=ze(),F.play(),ie&&document.body.requestFullscreen().then(()=>{screen.orientation.lock("landscape")}),Le.classList.add("hidden_block"),Re.classList.remove("hidden_block")});function D(e){lt.forEach(a=>{a.classList.add("hidden_block")}),e!=0&&e.classList.remove("hidden_block")}mt.addEventListener("click",async()=>{D(N),await X(),await Z(!0,!0),D(0),Y()}),Dt.addEventListener("click",async()=>{D(N),await X(),await Z(!0,!0),D(0),Y()}),St.addEventListener("click",async()=>{await X(),await Z(!0,!0),D(0),Y()}),yt.addEventListener("click",async()=>{D(N),await X(),await de()}),ht.addEventListener("click",async()=>{D(N),await X(),await de()}),bt.addEventListener("click",async()=>{D(N),await X(),await de()}),ye.addEventListener("click",()=>{he==!1&&C&&!R&&(D(_t),t.userData.time=_.getElapsedTime(),_.stop(),j=!0)}),ft.addEventListener("click",()=>{D(0),_.start(),_.elapsedTime=t.userData.time,j=!1}),wt.onchange=function(){this.checked?(q.shadowMap.enabled=!0,l.traverse(e=>{e.material&&(e.material.needsUpdate=!0)})):(q.shadowMap.enabled=!1,l.traverse(e=>{e.material&&(e.material.needsUpdate=!0)}))},gt.onchange=function(){this.checked?(g.canStart=!0,localStorage.setItem("playerData",JSON.stringify(g))):(g.canStart=!1,localStorage.setItem("playerData",JSON.stringify(g)))};let p,Oe=!0;performance.now();let Lt=[],M=0,j=!1,t,d,De,he=!1,ee=[],m=0,I,we,G=[],ge,R;const u=[{hSpeed:10,maxHSpeed:.08,stepSpeed:1,nowSpeed:0,maxSpeed:26,resetHAngle:!1,levels:[1,2,3,4,5,6,7],canInLevel:!1},{hSpeed:12,maxHSpeed:.1,stepSpeed:20.5,nowSpeed:0,maxSpeed:340,resetHAngle:!1,levels:[5,6,7],canInLevel:!1},{hSpeed:14,maxHSpeed:.12,stepSpeed:3,nowSpeed:0,maxSpeed:40,resetHAngle:!0,levels:[6,7],canInLevel:!1}];let K,P,F,He,b=[],T=new f,fe=new ce,C=!1,Se=!1,O,Je,We,y,B,A,x,v,te,ae,oe,V,U,be,H=[],ne=[],xe=[],h,ie=ze(),Rt=new le,_=new le,se=0,Ne=1/60,J=0,k=0,g;const je=new ce,kt=new f(0,-1,0),l=new Pe;l.background=new Ve(14479094),l.fog=new Ue(l.background,1,300);const Q=new Xe(16777215,16777215,2);Q.color.setHSL(.6,1,.6),Q.groundColor.setHSL(.095,1,.75),Q.position.set(0,100,0),new Ye(Q,10);const z=new Qe(16777215,3);z.position.set(1,2,.2),z.position.multiplyScalar(120),z.castShadow=!0,z.shadow.mapSize.width=2048,z.shadow.mapSize.height=2048;const re=1e3;z.shadow.camera.left=-re,z.shadow.camera.right=re,z.shadow.camera.top=re,z.shadow.camera.bottom=-re,z.shadow.camera.far=3500,z.shadow.bias=-.001,new Ze(z,10),new $e(11184810,1);const S=new et(85,document.body.offsetWidth/document.body.offsetHeight,.1,600);S.position.set(0,4,-10);let qt=new tt;const q=new at;q.setSize(document.body.offsetWidth,document.body.offsetHeight),document.body.appendChild(q.domElement),q.shadowMap.enabled=!0,q.shadowMap.type=ot,window.addEventListener("resize",Et,!1);function Et(){S.aspect=document.body.offsetWidth/document.body.offsetHeight,S.updateProjectionMatrix(),q.setSize(document.body.offsetWidth,document.body.offsetHeight)}async function Ct(){localStorage.getItem("playerData")?g=JSON.parse(localStorage.getItem("playerData")):(g={levelsTimes:{},canStart:!1},localStorage.setItem("playerData",JSON.stringify(g))),JSON.stringify(g),pt.forEach((e,a,o)=>{g.levelsTimes["time"+(a+1)]!=null?e.childNodes[1].textContent=g.levelsTimes["time"+(a+1)]:e.childNodes[1].textContent=0})}async function Bt(){_=new le,l.add(z),l.add(Q),k=0,await c.init(),p=new c.World(new c.Vector3(0,-9.81,0)),await new _e().loadAsync("models/map-menu.glb",onprogress=s=>{$.textContent=Math.round(s.loaded/s.total*100)+"%"}).then(s=>{const w=s.scene;$.textContent="0",w.traverse(i=>{if(i.name=="player")t=i.clone(),t.userData.vertices=t.geometry.attributes.position.array,t.userData.indices=t.geometry.index.array,t.castShadow=!0,t.receiveShadow=!0,t.material.transparent=!0,t.material.opacity=0,t.userData.mass=1,t.userData.playerBraking=!1,t.userData.hTransition=0,t.userData.currentSpeed=0,t.userData.boom=!1,t.userData.onStartArea=!0,t.userData.canBoostStep=!0,t.userData.time=0,t.userData.right=!1,t.userData.left=!1,t.userData.onGround=!1,t.userData.flying=!1,t.userData.origPosition=t.position,E(t),l.add(t);else if(i.name.includes("player-tube"))I=i.clone(),I.userData.startPosition=new f(I.position.x,I.position.y,I.position.z),ee[i.name.slice(-1)-1]=I,l.add(I);else if(i.name=="arrow_area")h=i.clone(),h.userData.hPos=0,l.add(h);else if(i.name.includes("ground"))new W().setFromObject(i).getSize(new f),O=i.clone(),O.receiveShadow=!0,O.userData.mass=0,E(O),H.push(O),l.add(O),i.name=="left_ground_wall"?Je=i.position:i.name=="right_ground_wall"&&(We=i.position);else if(i.name.includes("wall")){new W().setFromObject(i).getSize(new f);let L=i.clone();L.castShadow=!0,L.receiveShadow=!0,L.userData.mass=1,E(L),H.push(L),ne.push(L),l.add(L)}else if(i.name.includes("area")){let L=i.clone();L.castShadow=!0,l.add(L)}else i.name.includes("start_flag")?(we=i.clone(),l.add(we)):i.name.includes("itsmen_body")?(y=i.clone(),y.material.transparent=!0,y.material.opacity=0,l.add(y),E(y)):i.name.includes("itsmen_left_hand")?(B=i.clone(),B.material.transparent=!0,B.material.opacity=0,l.add(B),E(B)):i.name.includes("itsmen_right_hand")?(A=i.clone(),A.material.transparent=!0,A.material.opacity=0,l.add(A),E(A)):i.name.includes("itsmen_left_leg")?(x=i.clone(),x.material.transparent=!0,x.material.opacity=0,l.add(x),E(x)):i.name.includes("itsmen_right_leg")?(v=i.clone(),v.material.transparent=!0,v.material.opacity=0,l.add(v),E(v)):i.name.includes("qmen_body")?(te=i.clone(),l.add(te)):i.name.includes("qmen_left_hand")?(ae=i.clone(),l.add(ae)):i.name.includes("qmen_right_hand")?(oe=i.clone(),l.add(oe)):i.name.includes("qmen_left_leg")?(V=i.clone(),l.add(V)):i.name.includes("qmen_right_leg")&&(U=i.clone(),l.add(U))})}),l.traverse(function(s){s.material&&(s.material.needsUpdate=!0)}),await Ct();let e=c.JointData.spherical({x:.2,y:0,z:-.2},{x:-.4,y:0,z:0});p.createImpulseJoint(e,y.userData.body,B.userData.body,!0);let a=c.JointData.spherical({x:-.2,y:0,z:-.2},{x:.4,y:0,z:0});p.createImpulseJoint(a,y.userData.body,A.userData.body,!0);let o=c.JointData.spherical({x:.22,y:0,z:.5},{x:0,y:0,z:-.5});p.createImpulseJoint(o,y.userData.body,x.userData.body,!0);let r=c.JointData.spherical({x:-.22,y:0,z:.5},{x:0,y:0,z:-.5});p.createImpulseJoint(r,y.userData.body,v.userData.body,!0);let n=c.JointData.spherical({x:0,y:0,z:0},{x:0,y:.3,z:0});be=p.createImpulseJoint(n,y.userData.body,d,!0),Se=!0}async function At(){R=!1;const e=new _e,a="models/map"+M+".glb";await e.loadAsync(a,onprogress=o=>{$.textContent=Math.round(o.loaded/o.total*100)+"%"}).then(o=>{const r=o.scene;$.textContent="0",r.traverse(n=>{if(n.name.includes("ground")){new W().setFromObject(n).getSize(new f);let s=n.clone();s.receiveShadow=!0,s.userData.mass=0,s.name=n.name,E(s),H.push(s),l.add(s)}else if(n.name.includes("wall")){new W().setFromObject(n).getSize(new f);let s=n.clone();s.userData.mass=1,E(s),H.push(s),ne.push(s),l.add(s)}else if(n.name.includes("moving_block")){const s=new W().setFromObject(n).getSize(new f);let w=n.clone();w.userData.size=s,w.userData.mass=1,w.userData.raycaster=new ce,w.userData.speed=-n.name.substr(n.name.indexOf("speed")+6),w.userData.direction=new f(w.userData.speed,0,0),Ee.push(w),E(w),ne.push(w),l.add(w)}else if(n.name.includes("area")){let s=n.clone();s.castShadow=!0,s.receiveShadow=!0,l.add(s),n.name.includes("star_area")&&G.push(s)}else n.name.includes("finish_block")&&(ge=n.clone(),l.add(ge))})}),Ae.textContent=g.levelsTimes["time"+M]}async function Tt(){const e=new nt;t.add(e);const a=new it;await a.loadAsync("public/audio/slide.mp3").then(o=>{K=new ue(e),K.setBuffer(o),K.setLoop(!0),K.setRefDistance(40),K.setVolume(1),t.add(K)}),await a.loadAsync("public/audio/jump.mp3").then(o=>{P=new ue(e),P.setBuffer(o),P.setLoop(!1),P.setRefDistance(40),P.setVolume(.4),t.add(P)}),await a.loadAsync("public/audio/around.mp3").then(o=>{F=new ue(e),F.setBuffer(o),F.setLoop(!0),F.setRefDistance(40),F.setVolume(1),t.add(F)})}async function de(){await Z(!0,!1),Oe?(D(Le),Oe=!1):D(Re)}de();async function Z(e,a){e&&await Bt(),a&&await At(),await Tt()}async function X(){for(C=!1,Se=!1,k=0,t.userData.time=0,t.userData.boom=!1,u.forEach(e=>{e.nowSpeed=0}),H=[],ne=[],G=[],b=[],ye.classList.add("hidden_block"),Be.classList.add("hidden_block"),Te.classList.add("hidden_block"),_.start(),_.elapsedTime=t.userData.time,j=!1,t.userData.currentSpeed=0,Ie.textContent=t.userData.currentSpeed,k=0,me.textContent=k;l.children.length>0;){let e=l.children[0];e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(a=>a.dispose()):e.material.dispose()),l.remove(e)}R=!1}function It(){if(performance.now(),Se&&!R&&(ie?t.userData.boom?S.lookAt(y.position):(S.lookAt(new f(S.position.x,t.position.y,t.position.z+5)),S.position.y=t.position.y+5,S.position.z=t.position.z-3):t.userData.boom?I.position.y>0&&S.lookAt(y.position):(S.lookAt(new f(S.position.x,t.position.y,t.position.z+5)),S.position.y=t.position.y+4,S.position.z=t.position.z-4),h.position.set(t.position.x,t.position.y,t.position.z+5)),C){R?D(rt):(k=_.getElapsedTime().toFixed(3),me.textContent=k,Ft(),Mt(),G.forEach((a,o,r)=>{a.rotation.z+=.05}),pe(t,G)&&(console.log(pe(t,G)),l.remove(pe(t,G)))),t.position.x>Je.x-t.userData.size.x/1.3&&(h.position.x=t.position.x,t.userData.hTransition=-.4),t.position.x<We.x+t.userData.size.x/1.3&&(h.position.x=t.position.x,t.userData.hTransition=.4);let e=new c.EventQueue(!0);p.step(e),ee[m].position.copy(d.translation()),ee[m].quaternion.copy(d.rotation()),te.position.copy(y.position),te.rotation.copy(y.rotation),ae.position.copy(B.position),ae.rotation.copy(B.rotation),oe.position.copy(A.position),oe.rotation.copy(A.rotation),V.position.copy(x.position),V.rotation.copy(x.rotation),U.position.copy(v.position),U.rotation.copy(v.rotation);for(let a=0,o=b.length;a<o;a++)b[a][0].position.copy(b[a][1].translation()),b[a][0].quaternion.copy(b[a][1].rotation());e.drainCollisionEvents((a,o,r)=>{xe.forEach((n,s)=>{d.handle==a&&n.handle==o&&!R?d.linvel().z<15&&t.userData.boom==!1&&(p.removeImpulseJoint(be),y.userData.body.applyImpulse({x:5,y:5,z:5},!0),y.userData.body.setEnabledRotations(!0),De.setFriction(20),setTimeout(()=>{C=!1,D(ke)},2e3),t.userData.boom=!0):d.handle==a&&!R&&d.linvel().z<15&&t.position.y<5&&t.userData.boom==!1&&(p.removeImpulseJoint(be),y.userData.body.applyImpulse({x:5,y:5,z:5},!0),y.userData.body.setEnabledRotations(!0),De.setFriction(20),t.userData.boom=!0,setTimeout(()=>{C=!1,D(ke)},2e3))})})}qt.update()}q.setAnimationLoop(()=>{se+=Rt.getDelta(),se>Ne&&!j&&(It(),q.render(l,S),se=se%Ne)}),document.addEventListener("touchend",Ht),document.addEventListener("touchstart",Ge),document.addEventListener("touchmove",Ge),window.addEventListener("keydown",Jt),window.addEventListener("keyup",Wt),document.addEventListener("mousedown",Ot,!1);function Mt(){Ee.forEach((e,a)=>{let o=e,r=Ce[a];r.setLinvel(o.userData.direction,!0),r.setAngvel({x:o.userData.direction.z,y:o.userData.direction.y,z:-o.userData.direction.x},!0);const n=o.userData.direction;o.userData.raycaster.set(new f(o.position.x,.4,o.position.z),n.clone().normalize());const s=o.userData.raycaster.intersectObjects(H);s.length>0&&s[0].distance<o.userData.size.x/2&&(o.userData.direction.x=o.userData.direction.x*-1)})}function Ft(){t.position.z>ge.position.z&&!t.userData.boom&&(k=_.getElapsedTime().toFixed(3),me.textContent=k,R=!0,dt.textContent=k,g.levelsTimes["time"+M]!=null?J=g.levelsTimes["time"+M]:J=0,(k<J||J==0)&&(J=k,Ae.textContent=J,g.levelsTimes["time"+M]=J,localStorage.setItem("playerData",JSON.stringify(g))),t.position.z=0),h.position.x+=t.userData.hTransition;const e=new f().subVectors(d.translation(),h.position).normalize(),a=d.linvel(),o=new f(e.x*-u[m].hSpeed,a.y,e.z*-u[m].nowSpeed);d.translation().y<68&&d.translation().y>=10&&(u[m].nowSpeed+=.05,d.rotation().x<.04&&d.setRotation({w:d.rotation().w,x:.04,y:d.rotation().y,z:d.rotation().z})),d.translation().y<10&&d.translation().y>1&&d.rotation().x<.04&&d.lockRotations(!0,!0,!0),d.setLinvel(o,!0),h.lookAt(h.position.x-(t.position.x-h.position.x),h.position.y-(t.position.y-h.position.y),h.position.z-(t.position.z-h.position.z)),d.setRotation({w:h.quaternion.w,x:d.rotation().x,y:h.quaternion.y,z:d.rotation().z}),y.userData.body.setRotation({w:h.quaternion.w,x:d.rotation().x,y:h.quaternion.y,z:d.rotation().z}),(V.rotation.y>0||V.rotation.y<0)&&x.userData.body.setRotation({w:x.userData.body.rotation().w,x:x.userData.body.rotation().x,y:0,z:x.userData.body.rotation().z}),(U.rotation.y>0||U.rotation.y<0)&&v.userData.body.setRotation({w:v.userData.body.rotation().w,x:v.userData.body.rotation().x,y:0,z:v.userData.body.rotation().z}),je.set(t.position,kt);const r=je.intersectObjects(H);r.length>0&&(r[0].distance<.4?(t.userData.flying=!1,!t.userData.onGround&&t.userData.flying,t.userData.onGround=!0):(t.userData.onGround=!1,t.userData.flying=!0)),d.linvel().z>0?t.userData.currentSpeed=d.linvel().z.toFixed(0):t.userData.currentSpeed=0,Ie.textContent=t.userData.currentSpeed,t.userData.left&&t.userData.onGround&&!t.userData.onStartArea&&(t.userData.hTransition<5&&(t.userData.hTransition+=u[m].maxHSpeed),u[m].nowSpeed-=.009),t.userData.right&&t.userData.onGround&&!t.userData.onStartArea&&(t.userData.hTransition>-5&&(t.userData.hTransition-=u[m].maxHSpeed),u[m].nowSpeed-=.009),u[m].resetHAngle&&!t.userData.left&&!t.userData.right&&(t.userData.hTransition<-u[m].maxHSpeed?t.userData.hTransition+=u[m].maxHSpeed:t.userData.hTransition>u[m].maxHSpeed?t.userData.hTransition-=u[m].maxHSpeed:t.userData.hTransition=0),t.position.z>we.position.z?t.userData.onStartArea=!1:t.userData.onStartArea=!0}function Ge(e){if(t.userData.onGround){e=e.changedTouches[0];var a=q.domElement.getBoundingClientRect();T.x=(e.clientX-a.left)/a.width*2-1,T.y=-((e.clientY-a.top)/a.height)*2+1,fe.setFromCamera(T,S),T.y>0&&t.userData.canBoostStep&&C&&t.userData.onStartArea&&d.linvel().z<u[m].maxSpeed&&d.linvel().y<5&&d.linvel().y>-5&&!R&&u[m].nowSpeed<u[m].maxSpeed&&(u[m].nowSpeed+=u[m].stepSpeed),t.userData.canBoostStep=!1,T.y<0&&(T.x>0?(t.userData.left=!1,t.userData.right=!0):(t.userData.right=!1,t.userData.left=!0))}}function Ot(e){e.preventDefault();var a=q.domElement.getBoundingClientRect();T.x=(e.clientX-a.left)/a.width*2-1,T.y=-((e.clientY-a.top)/a.height)*2+1,fe.setFromCamera(T,S),Lt.forEach(o=>{o.geometry.computeBoundingBox();var r=o.geometry.boundingBox.clone();r.applyMatrix4(o.matrixWorld),fe.ray.intersectBox(r,new f)})}function Ht(e){t.userData.right=!1,t.userData.left=!1,t.userData.canBoostStep=!0}function Jt(e){switch(e.code){case"KeyW":case"ArrowUp":t.userData.canBoostStep&&C&&t.userData.onStartArea&&d.linvel().z<u[m].maxSpeed&&d.linvel().y<5&&d.linvel().y>-5&&!R&&u[m].nowSpeed<u[m].maxSpeed&&(u[m].nowSpeed+=u[m].stepSpeed),t.userData.canBoostStep=!1;break;case"KeyS":case"ArrowDown":d.applyImpulse({x:0,y:0,z:-u[m].stepSpeed/2},!0),t.userData.playerBraking=!0;break;case"KeyA":case"ArrowLeft":t.userData.left=!0;break;case"KeyD":case"ArrowRight":t.userData.right=!0;break}}function Wt(e){switch(e.code){case"KeyW":case"ArrowUp":t.userData.canBoostStep=!0;break;case"KeyS":case"ArrowDown":d.linvel().y<.1&&(t.userData.playerBraking=!1);break;case"KeyA":case"ArrowLeft":t.userData.left=!1;break;case"KeyD":case"ArrowRight":t.userData.right=!1;break}}function E(e){let a,o;const r=e.rotation.clone();e.rotation.set(0,0,0);const n=new W().setFromObject(e).getSize(new f);if(e.rotation.copy(r),e.name.includes("player")?(t.userData.size=n,t.userData.orgRotation=r,a=p.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!1,!1).setLinearDamping(0).setAngularDamping(2)),o=c.ColliderDesc.cuboid(n.x/5,n.y/1.5,n.z/3).setMass(e.userData.mass).setRestitution(0).setFriction(0),d=a,De=o,o.setActiveEvents(c.ActiveEvents.COLLISION_EVENTS),p.createCollider(o,a),t.userData.handle=d.handle,b.push([e,a,e.id])):e.name.includes("ground")&&(a=p.createRigidBody(c.RigidBodyDesc.fixed().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0)),o=c.ColliderDesc.cuboid(n.x/2,n.y/2,n.z/2).setMass(e.userData.mass).setRestitution(0).setFriction(0),p.createCollider(o,a),He=a,O.userData.handle=He.handle,b.push([e,a,e.id])),e.name.includes("wall")){a=p.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!0,!1).setLinearDamping(0)),o=c.ColliderDesc.cuboid(n.x/2,n.y/2,n.z/2).setMass(e.userData.mass*10).setRestitution(0).setFriction(40);let s=p.createCollider(o,a);xe.push(s),b.push([e,a,e.id])}if(e.name.includes("moving_block")){a=p.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!0,!0,!0).setLinearDamping(0)),o=c.ColliderDesc.ball(n.x/2).setMass(e.userData.mass*10).setRestitution(0).setFriction(20);let s=a;Ce.push(s);let w=p.createCollider(o,a);xe.push(w),b.push([e,a,e.id])}e.name.includes("itsmen_body")&&(a=p.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!1,!0).setLinearDamping(0).setAngularDamping(0)),o=c.ColliderDesc.cuboid(n.x/2,n.y/2,n.z/2).setMass(0).setRestitution(0).setFriction(0).setDensity(2),y.userData.body=a,y.userData.collider=o,p.createCollider(o,a),b.push([e,a,e.id])),e.name.includes("itsmen_left_hand")&&(a=p.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),o=c.ColliderDesc.capsule(n.z/2,n.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),B.userData.body=a,B.userData.collider=o,p.createCollider(o,a),b.push([e,a,e.id])),e.name.includes("itsmen_right_hand")&&(a=p.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),o=c.ColliderDesc.capsule(n.z/2,n.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),A.userData.body=a,A.userData.collider=o,p.createCollider(o,a),b.push([e,a,e.id])),e.name.includes("itsmen_left_leg")&&(a=p.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),o=c.ColliderDesc.capsule(n.z/2,n.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),x.userData.body=a,x.userData.collider=o,p.createCollider(o,a),b.push([e,a,e.id])),e.name.includes("itsmen_right_leg")&&(a=p.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),o=c.ColliderDesc.capsule(n.z/2,n.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),v.userData.body=a,v.userData.collider=o,p.createCollider(o,a),b.push([e,a,e.id]))}document.addEventListener("visibilitychange",function(){document.visibilityState==="visible"?!R&&C&&j==!1&&(_.start(),_.elapsedTime=t.userData.time):j==!1&&!R&&C&&(t.userData.time=_.getElapsedTime(),_.stop())});
