import{C as se,S as je,a as Ge,F as Ke,H as Pe,b as Ue,D as Xe,c as Ve,A as Ye,P as $e,d as Qe,W as Ze,e as et,V as S,R as re,G as be,B as J,f as tt}from"./three-CPvv5sxK.js";import{O as c}from"./@dimforge-D3Mqfikn.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}})();function le(e,a){e.geometry.computeBoundingBox(),a.forEach(function(o,s,D){o.children.length>0?o.children.forEach(function(i,L,Ne){i.geometry.computeBoundingBox()}):o.geometry.computeBoundingBox()}),e.updateMatrixWorld(),a.forEach(function(o,s,D){o.updateMatrixWorld()});let n=e.geometry.boundingBox.clone();n.applyMatrix4(e.matrixWorld);var r=!1;return a.forEach(function(o,s,D){if(o.children.length>0)o.children.forEach(function(i,L,Ne){let fe=i.geometry.boundingBox.clone();fe.applyMatrix4(i.matrixWorld),n.intersectsBox(fe)&&(r=i)});else{let i=o.geometry.boundingBox.clone();i.applyMatrix4(o.matrixWorld),n.intersectsBox(i)&&(r=o)}}),r}function xe(){let e=window.matchMedia||window.msMatchMedia;return e?e("(pointer:coarse)").matches:!1}let W=document.querySelector(".main_load"),ve=document.querySelector(".main_menu"),_e=document.querySelector(".select_level"),at=document.querySelectorAll(".select_level .level_shadow"),ot=document.querySelector(".select_tube"),nt=document.querySelector(".finish_window"),it=document.querySelector(".finish_you_time span"),ze=document.querySelector(".boom_window"),st=document.querySelectorAll("body>.overlay"),rt=document.querySelector(".startButton"),lt=document.querySelectorAll(".load_level_wrap>div"),dt=document.querySelectorAll(".load_level_wrap .level_time"),Le=document.querySelectorAll(".load_tubes_wrap>div"),ke=[],qe=[],Re=document.querySelector(".times"),de=document.querySelector(".current_time"),Ee=document.querySelector(".best_time"),ct=document.querySelector(".finish_window .finish_again"),ut=document.querySelector(".finish_window .finish_in_menu"),mt=document.querySelector(".boom_window .finish_again"),pt=document.querySelector(".boom_window .finish_in_menu"),Ce=document.querySelector(".speed_block"),Ae=document.querySelector(".speed_block>.speed"),yt=document.querySelector(".shadow_check"),ht=document.querySelector(".instr_check"),Y=document.querySelector(".load_percent"),ce=document.querySelector(".pause_button_wrap"),Dt=document.querySelector(".close_pause_button"),gt=document.querySelector(".reset_button"),wt=document.querySelector(".inmenu_button"),St=document.querySelector(".before_start"),ft=document.querySelector(".instruction_start_btn"),bt=document.querySelector(".menu_in_game_wrap"),Be=document.querySelector(".start_time"),Te=document.querySelector(".start_time_wrap"),xt=document.querySelector(".clear_rec");xt.addEventListener("click",()=>{localStorage.clear()}),lt.forEach((e,a)=>{e.addEventListener("click",async()=>{a+1<=Se&&(M=a+1,Le.forEach((n,r)=>{u[r].levels.includes(M)?(n.classList.remove("disabledTube"),u[r].canInLevel=!0):(n.classList.add("disabledTube"),u[r].canInLevel=!1)}),h(W),await V(!1,!0),h(ot))})}),Le.forEach((e,a)=>{e.addEventListener("click",()=>{u[a].canInLevel&&(p=a,h(0),U())})});function U(){if(!w.canStart)h(St),ae?document.querySelector(".mobile_instr").classList.remove("hidden_instr"):document.querySelector(".desktop_instr").classList.remove("hidden_instr");else{Re.classList.remove("hidden_block"),Ce.classList.remove("hidden_block"),$[p].position.copy(l.translation());let e=3;me=!0;let a=setInterval(n=>{Te.classList.remove("hidden_block"),e++,e==4?(me=!1,Be.textContent="GO",C=!0,ce.classList.remove("hidden_block"),clearInterval(a),setTimeout(()=>{Te.classList.add("hidden_block")},600)):Be.textContent=4-e},1e3)}}ft.addEventListener("click",()=>{w.canStart=!0,h(0),U()}),rt.addEventListener("click",()=>{ae=xe(),ae&&document.body.requestFullscreen().then(()=>{screen.orientation.lock("landscape")}),ve.classList.add("hidden_block"),_e.classList.remove("hidden_block")});function h(e){st.forEach(a=>{a.classList.add("hidden_block")}),e!=0&&e.classList.remove("hidden_block")}ct.addEventListener("click",async()=>{h(W),await P(),await V(!0,!0),h(0),U()}),mt.addEventListener("click",async()=>{h(W),await P(),await V(!0,!0),h(0),U()}),gt.addEventListener("click",async()=>{await P(),await V(!0,!0),h(0),U()}),ut.addEventListener("click",async()=>{h(W),await P(),await ie()}),pt.addEventListener("click",async()=>{h(W),await P(),await ie()}),wt.addEventListener("click",async()=>{h(W),await P(),await ie()}),ce.addEventListener("click",()=>{me==!1&&C&&!k&&(h(bt),t.userData.time=_.getElapsedTime(),_.stop(),N=!0)}),Dt.addEventListener("click",()=>{h(0),_.start(),_.elapsedTime=t.userData.time,N=!1}),yt.onchange=function(){this.checked?(R.shadowMap.enabled=!0,d.traverse(e=>{e.material&&(e.material.needsUpdate=!0)})):(R.shadowMap.enabled=!1,d.traverse(e=>{e.material&&(e.material.needsUpdate=!0)}))},ht.onchange=function(){this.checked?(w.canStart=!0,localStorage.setItem("playerData",JSON.stringify(w))):(w.canStart=!1,localStorage.setItem("playerData",JSON.stringify(w)))};let m,Ie=!0;performance.now();let vt=[],M=0,N=!1,t,l,ue,me=!1,$=[],p=0,I,pe,j=[],ye,k;const u=[{hSpeed:10,maxHSpeed:.08,stepSpeed:1,nowSpeed:0,maxSpeed:26,resetHAngle:!1,levels:[1,2,3,4,5,6,7],canInLevel:!1},{hSpeed:12,maxHSpeed:.1,stepSpeed:2,nowSpeed:0,maxSpeed:38,resetHAngle:!1,levels:[5,6,7],canInLevel:!1},{hSpeed:14,maxHSpeed:.12,stepSpeed:3,nowSpeed:0,maxSpeed:44,resetHAngle:!0,levels:[6,7],canInLevel:!1}];let Me,b=[],T=new S,he=new re,C=!1,De=!1,F,Fe,Oe,y,A,B,x,v,Q,Z,ee,G,K,ge,O=[],te=[],we=[],g,ae=xe(),_t=new se,_=new se,oe=0,He=1/60,H=0,q=0,Se=2,w;const Je=new re,zt=new S(0,-1,0),d=new je;d.background=new Ge(14479094),d.fog=new Ke(d.background,1,300);const X=new Pe(16777215,16777215,2);X.color.setHSL(.6,1,.6),X.groundColor.setHSL(.095,1,.75),X.position.set(0,100,0),new Ue(X,10);const z=new Xe(16777215,3);z.position.set(1,2,.2),z.position.multiplyScalar(120),z.castShadow=!0,z.shadow.mapSize.width=2048,z.shadow.mapSize.height=2048;const ne=1e3;z.shadow.camera.left=-ne,z.shadow.camera.right=ne,z.shadow.camera.top=ne,z.shadow.camera.bottom=-ne,z.shadow.camera.far=3500,z.shadow.bias=-.001,new Ve(z,10),new Ye(11184810,1);const f=new $e(85,document.body.offsetWidth/document.body.offsetHeight,.1,600);f.position.set(0,4,-10);let Lt=new Qe;const R=new Ze;R.setSize(document.body.offsetWidth,document.body.offsetHeight),document.body.appendChild(R.domElement),R.shadowMap.enabled=!0,R.shadowMap.type=et,window.addEventListener("resize",kt,!1);function kt(){f.aspect=document.body.offsetWidth/document.body.offsetHeight,f.updateProjectionMatrix(),R.setSize(document.body.offsetWidth,document.body.offsetHeight)}async function qt(){localStorage.getItem("playerData")?w=JSON.parse(localStorage.getItem("playerData")):(w={levelsTimes:{},canStart:!1},localStorage.setItem("playerData",JSON.stringify(w))),JSON.stringify(w),Se=0,at.forEach((e,a)=>{a<Object.keys(w.levelsTimes).length+2&&(Se++,e.classList.remove("level_disabled"))}),dt.forEach((e,a,n)=>{w.levelsTimes["time"+(a+1)]!=null?e.childNodes[1].textContent=w.levelsTimes["time"+(a+1)]:e.childNodes[1].textContent="00.000"})}async function Rt(){_=new se,d.add(z),d.add(X),q=0,await c.init(),m=new c.World(new c.Vector3(0,-9.81,0)),await new be().loadAsync("models/map-menu.glb",onprogress=s=>{console.log(`Loaded: ${s.loaded}, Total: ${s.total}`);let D=Math.min(Math.round(s.loaded/s.total*100),100);Y.textContent=D+"%"}).then(s=>{const D=s.scene;Y.textContent="0",D.traverse(i=>{if(i.name=="player")t=i.clone(),t.userData.vertices=t.geometry.attributes.position.array,t.userData.indices=t.geometry.index.array,t.castShadow=!0,t.receiveShadow=!0,t.material.transparent=!0,t.material.opacity=0,t.userData.mass=1,t.userData.playerBraking=!1,t.userData.hTransition=0,t.userData.currentSpeed=0,t.userData.boom=!1,t.userData.onStartArea=!0,t.userData.canBoostStep=!0,t.userData.time=0,t.userData.right=!1,t.userData.left=!1,t.userData.onGround=!1,t.userData.flying=!1,t.userData.origPosition=t.position,E(t),d.add(t);else if(i.name.includes("player-tube"))I=i.clone(),I.userData.startPosition=new S(I.position.x,I.position.y,I.position.z),$[i.name.slice(-1)-1]=I,d.add(I);else if(i.name=="arrow_area")g=i.clone(),g.userData.hPos=0,d.add(g);else if(i.name.includes("ground"))new J().setFromObject(i).getSize(new S),F=i.clone(),F.receiveShadow=!0,F.userData.mass=0,E(F),O.push(F),d.add(F),i.name=="left_ground_wall"?Fe=i.position:i.name=="right_ground_wall"&&(Oe=i.position);else if(i.name.includes("wall")){new J().setFromObject(i).getSize(new S);let L=i.clone();L.castShadow=!0,L.receiveShadow=!0,L.userData.mass=1,E(L),O.push(L),te.push(L),d.add(L)}else if(i.name.includes("area")){let L=i.clone();L.castShadow=!0,d.add(L)}else i.name.includes("start_flag")?(pe=i.clone(),d.add(pe)):i.name.includes("itsmen_body")?(y=i.clone(),y.material.transparent=!0,y.material.opacity=0,d.add(y),E(y)):i.name.includes("itsmen_left_hand")?(A=i.clone(),A.material.transparent=!0,A.material.opacity=0,d.add(A),E(A)):i.name.includes("itsmen_right_hand")?(B=i.clone(),B.material.transparent=!0,B.material.opacity=0,d.add(B),E(B)):i.name.includes("itsmen_left_leg")?(x=i.clone(),x.material.transparent=!0,x.material.opacity=0,d.add(x),E(x)):i.name.includes("itsmen_right_leg")?(v=i.clone(),v.material.transparent=!0,v.material.opacity=0,d.add(v),E(v)):i.name.includes("qmen_body")?(Q=i.clone(),d.add(Q)):i.name.includes("qmen_left_hand")?(Z=i.clone(),d.add(Z)):i.name.includes("qmen_right_hand")?(ee=i.clone(),d.add(ee)):i.name.includes("qmen_left_leg")?(G=i.clone(),d.add(G)):i.name.includes("qmen_right_leg")&&(K=i.clone(),d.add(K))})}),d.traverse(function(s){s.material&&(s.material.needsUpdate=!0)}),await qt();let e=c.JointData.spherical({x:.2,y:0,z:-.2},{x:-.4,y:0,z:0});m.createImpulseJoint(e,y.userData.body,A.userData.body,!0);let a=c.JointData.spherical({x:-.2,y:0,z:-.2},{x:.4,y:0,z:0});m.createImpulseJoint(a,y.userData.body,B.userData.body,!0);let n=c.JointData.spherical({x:.22,y:0,z:.5},{x:0,y:0,z:-.5});m.createImpulseJoint(n,y.userData.body,x.userData.body,!0);let r=c.JointData.spherical({x:-.22,y:0,z:.5},{x:0,y:0,z:-.5});m.createImpulseJoint(r,y.userData.body,v.userData.body,!0);let o=c.JointData.spherical({x:0,y:0,z:0},{x:0,y:.3,z:0});ge=m.createImpulseJoint(o,y.userData.body,l,!0),De=!0}async function Et(){k=!1;const e=new be,a="models/map"+M+".glb";await e.loadAsync(a,onprogress=n=>{let r=Math.min(Math.round(n.loaded/n.total*100),100);Y.textContent=r+"%"}).then(n=>{const r=n.scene;Y.textContent="0",r.traverse(o=>{if(o.name.includes("ground")){new J().setFromObject(o).getSize(new S);let s=o.clone();s.receiveShadow=!0,s.userData.mass=0,s.name=o.name,E(s),O.push(s),d.add(s)}else if(o.name.includes("wall")){new J().setFromObject(o).getSize(new S);let s=o.clone();s.userData.mass=1,E(s),O.push(s),te.push(s),d.add(s)}else if(o.name.includes("moving_block")){const s=new J().setFromObject(o).getSize(new S);let D=o.clone();D.userData.size=s,D.userData.mass=1,D.userData.raycaster=new re,D.userData.speed=-o.name.substr(o.name.indexOf("speed")+6),D.userData.direction=new S(D.userData.speed,0,0),ke.push(D),E(D),te.push(D),d.add(D)}else if(o.name.includes("area")){let s=o.clone();s.castShadow=!0,s.receiveShadow=!0,d.add(s),o.name.includes("star_area")&&j.push(s)}else o.name.includes("finish_block")&&(ye=o.clone(),d.add(ye))})}),Ee.textContent=w.levelsTimes["time"+M]}async function Ct(){const e=new tt;t.add(e)}async function ie(){await V(!0,!1),Ie?(h(ve),Ie=!1):h(_e)}ie();async function V(e,a){e&&await Rt(),a&&await Et(),await Ct()}async function P(){for(C=!1,De=!1,q=0,t.userData.time=0,t.userData.boom=!1,u.forEach(e=>{e.nowSpeed=0}),O=[],te=[],j=[],b=[],ce.classList.add("hidden_block"),Re.classList.add("hidden_block"),Ce.classList.add("hidden_block"),_.start(),_.elapsedTime=t.userData.time,N=!1,t.userData.currentSpeed=0,Ae.textContent=t.userData.currentSpeed,q=0,de.textContent=q;d.children.length>0;){let e=d.children[0];e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(a=>a.dispose()):e.material.dispose()),d.remove(e)}k=!1}function At(){if(performance.now(),De&&!k&&(ae?t.userData.boom?f.lookAt(y.position):(f.lookAt(new S(f.position.x,t.position.y,t.position.z+5)),f.position.y=t.position.y+5,f.position.z=t.position.z-3):t.userData.boom?I.position.y>0&&f.lookAt(y.position):(f.lookAt(new S(f.position.x,t.position.y,t.position.z+5)),f.position.y=t.position.y+4,f.position.z=t.position.z-4),g.position.set(t.position.x,t.position.y,t.position.z+5)),C){k?h(nt):(q=_.getElapsedTime().toFixed(3),de.textContent=q,Tt(),Bt(),j.forEach((a,n,r)=>{a.rotation.z+=.05}),le(t,j)&&(console.log(le(t,j)),d.remove(le(t,j)))),t.position.x>Fe.x-t.userData.size.x/1.3&&(g.position.x=t.position.x,t.userData.hTransition=-.4),t.position.x<Oe.x+t.userData.size.x/1.3&&(g.position.x=t.position.x,t.userData.hTransition=.4);let e=new c.EventQueue(!0);m.step(e),$[p].position.copy(l.translation()),$[p].quaternion.copy(l.rotation()),Q.position.copy(y.position),Q.rotation.copy(y.rotation),Z.position.copy(A.position),Z.rotation.copy(A.rotation),ee.position.copy(B.position),ee.rotation.copy(B.rotation),G.position.copy(x.position),G.rotation.copy(x.rotation),K.position.copy(v.position),K.rotation.copy(v.rotation);for(let a=0,n=b.length;a<n;a++)b[a][0].position.copy(b[a][1].translation()),b[a][0].quaternion.copy(b[a][1].rotation());e.drainCollisionEvents((a,n,r)=>{we.forEach((o,s)=>{l.handle==a&&o.handle==n&&!k?l.linvel().z<15&&t.userData.boom==!1&&(m.removeImpulseJoint(ge),y.userData.body.applyImpulse({x:5,y:5,z:5},!0),y.userData.body.setEnabledRotations(!0),ue.setFriction(20),setTimeout(()=>{C=!1,h(ze)},2e3),t.userData.boom=!0):l.handle==a&&!k&&l.linvel().z<15&&t.position.y<5&&t.userData.boom==!1&&(m.removeImpulseJoint(ge),y.userData.body.applyImpulse({x:5,y:5,z:5},!0),y.userData.body.setEnabledRotations(!0),ue.setFriction(20),t.userData.boom=!0,setTimeout(()=>{C=!1,h(ze)},2e3))})})}Lt.update()}R.setAnimationLoop(()=>{oe+=_t.getDelta(),oe>He&&!N&&(At(),R.render(d,f),oe=oe%He)}),document.addEventListener("touchend",Mt),document.addEventListener("touchstart",We),document.addEventListener("touchmove",We),window.addEventListener("keydown",Ft),window.addEventListener("keyup",Ot),document.addEventListener("mousedown",It,!1);function Bt(){ke.forEach((e,a)=>{let n=e,r=qe[a];r.setLinvel(n.userData.direction,!0),r.setAngvel({x:n.userData.direction.z,y:n.userData.direction.y,z:-n.userData.direction.x},!0);const o=n.userData.direction;n.userData.raycaster.set(new S(n.position.x,.4,n.position.z),o.clone().normalize());const s=n.userData.raycaster.intersectObjects(O);s.length>0&&s[0].distance<n.userData.size.x/2&&(n.userData.direction.x=n.userData.direction.x*-1)})}function Tt(){t.position.z>ye.position.z&&!t.userData.boom&&(q=_.getElapsedTime().toFixed(3),de.textContent=q,k=!0,it.textContent=q,w.levelsTimes["time"+M]!=null?H=w.levelsTimes["time"+M]:H=0,(q<H||H==0)&&(H=q,Ee.textContent=H,w.levelsTimes["time"+M]=H,localStorage.setItem("playerData",JSON.stringify(w))),t.position.z=0),g.position.x+=t.userData.hTransition;const e=new S().subVectors(l.translation(),g.position).normalize(),a=l.linvel(),n=new S(e.x*-u[p].hSpeed,a.y,e.z*-u[p].nowSpeed);l.translation().y<68&&l.translation().y>=10&&(u[p].nowSpeed+=.05,l.rotation().x<.04&&l.setRotation({w:l.rotation().w,x:.04,y:l.rotation().y,z:l.rotation().z})),l.translation().y<10&&l.translation().y>1&&l.rotation().x<.04&&l.lockRotations(!0,!0,!0),l.setLinvel(n,!0),g.lookAt(g.position.x-(t.position.x-g.position.x),g.position.y-(t.position.y-g.position.y),g.position.z-(t.position.z-g.position.z)),l.setRotation({w:g.quaternion.w,x:l.rotation().x,y:g.quaternion.y,z:l.rotation().z}),y.userData.body.setRotation({w:g.quaternion.w,x:l.rotation().x,y:g.quaternion.y,z:l.rotation().z}),(G.rotation.y>0||G.rotation.y<0)&&x.userData.body.setRotation({w:x.userData.body.rotation().w,x:x.userData.body.rotation().x,y:0,z:x.userData.body.rotation().z}),(K.rotation.y>0||K.rotation.y<0)&&v.userData.body.setRotation({w:v.userData.body.rotation().w,x:v.userData.body.rotation().x,y:0,z:v.userData.body.rotation().z}),Je.set(t.position,zt);const r=Je.intersectObjects(O);r.length>0&&(r[0].distance<.4?(t.userData.flying=!1,!t.userData.onGround&&t.userData.flying,t.userData.onGround=!0):(t.userData.onGround=!1,t.userData.flying=!0)),l.linvel().z>0?t.userData.currentSpeed=l.linvel().z.toFixed(0):t.userData.currentSpeed=0,Ae.textContent=t.userData.currentSpeed,t.userData.left&&t.userData.onGround&&!t.userData.onStartArea&&(t.userData.hTransition<5&&(t.userData.hTransition+=u[p].maxHSpeed),u[p].nowSpeed-=.009),t.userData.right&&t.userData.onGround&&!t.userData.onStartArea&&(t.userData.hTransition>-5&&(t.userData.hTransition-=u[p].maxHSpeed),u[p].nowSpeed-=.009),u[p].resetHAngle&&!t.userData.left&&!t.userData.right&&(t.userData.hTransition<-u[p].maxHSpeed?t.userData.hTransition+=u[p].maxHSpeed:t.userData.hTransition>u[p].maxHSpeed?t.userData.hTransition-=u[p].maxHSpeed:t.userData.hTransition=0),t.position.z>pe.position.z?t.userData.onStartArea=!1:t.userData.onStartArea=!0}function We(e){if(t.userData.onGround){e=e.changedTouches[0];var a=R.domElement.getBoundingClientRect();T.x=(e.clientX-a.left)/a.width*2-1,T.y=-((e.clientY-a.top)/a.height)*2+1,he.setFromCamera(T,f),T.y>0&&t.userData.canBoostStep&&C&&t.userData.onStartArea&&l.linvel().z<u[p].maxSpeed&&l.linvel().y<5&&l.linvel().y>-5&&!k&&u[p].nowSpeed<u[p].maxSpeed&&(u[p].nowSpeed+=u[p].stepSpeed),t.userData.canBoostStep=!1,T.y<0&&(T.x>0?(t.userData.left=!1,t.userData.right=!0):(t.userData.right=!1,t.userData.left=!0))}}function It(e){e.preventDefault();var a=R.domElement.getBoundingClientRect();T.x=(e.clientX-a.left)/a.width*2-1,T.y=-((e.clientY-a.top)/a.height)*2+1,he.setFromCamera(T,f),vt.forEach(n=>{n.geometry.computeBoundingBox();var r=n.geometry.boundingBox.clone();r.applyMatrix4(n.matrixWorld),he.ray.intersectBox(r,new S)})}function Mt(e){t.userData.right=!1,t.userData.left=!1,t.userData.canBoostStep=!0}function Ft(e){switch(e.code){case"KeyW":case"ArrowUp":t.userData.canBoostStep&&C&&t.userData.onStartArea&&l.linvel().z<u[p].maxSpeed&&l.linvel().y<5&&l.linvel().y>-5&&!k&&u[p].nowSpeed<u[p].maxSpeed&&(u[p].nowSpeed+=u[p].stepSpeed),t.userData.canBoostStep=!1;break;case"KeyS":case"ArrowDown":l.applyImpulse({x:0,y:0,z:-u[p].stepSpeed/2},!0),t.userData.playerBraking=!0;break;case"KeyA":case"ArrowLeft":t.userData.left=!0;break;case"KeyD":case"ArrowRight":t.userData.right=!0;break}}function Ot(e){switch(e.code){case"KeyW":case"ArrowUp":t.userData.canBoostStep=!0;break;case"KeyS":case"ArrowDown":l.linvel().y<.1&&(t.userData.playerBraking=!1);break;case"KeyA":case"ArrowLeft":t.userData.left=!1;break;case"KeyD":case"ArrowRight":t.userData.right=!1;break}}function E(e){let a,n;const r=e.rotation.clone();e.rotation.set(0,0,0);const o=new J().setFromObject(e).getSize(new S);if(e.rotation.copy(r),e.name.includes("player")?(t.userData.size=o,t.userData.orgRotation=r,a=m.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!1,!1).setLinearDamping(0).setAngularDamping(2)),n=c.ColliderDesc.cuboid(o.x/5,o.y/1.5,o.z/3).setMass(e.userData.mass).setRestitution(0).setFriction(0),l=a,ue=n,n.setActiveEvents(c.ActiveEvents.COLLISION_EVENTS),m.createCollider(n,a),t.userData.handle=l.handle,b.push([e,a,e.id])):e.name.includes("ground")&&(a=m.createRigidBody(c.RigidBodyDesc.fixed().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0)),n=c.ColliderDesc.cuboid(o.x/2,o.y/2,o.z/2).setMass(e.userData.mass).setRestitution(0).setFriction(0),m.createCollider(n,a),Me=a,F.userData.handle=Me.handle,b.push([e,a,e.id])),e.name.includes("wall")){a=m.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!0,!1).setLinearDamping(0)),n=c.ColliderDesc.cuboid(o.x/2,o.y/2,o.z/2).setMass(e.userData.mass*10).setRestitution(0).setFriction(40);let s=m.createCollider(n,a);we.push(s),b.push([e,a,e.id])}if(e.name.includes("moving_block")){a=m.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!0,!0,!0).setLinearDamping(0)),n=c.ColliderDesc.ball(o.x/2).setMass(e.userData.mass*10).setRestitution(0).setFriction(20);let s=a;qe.push(s);let D=m.createCollider(n,a);we.push(D),b.push([e,a,e.id])}e.name.includes("itsmen_body")&&(a=m.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!0,!1,!0).setLinearDamping(0).setAngularDamping(0)),n=c.ColliderDesc.cuboid(o.x/2,o.y/2,o.z/2).setMass(0).setRestitution(0).setFriction(0).setDensity(2),y.userData.body=a,y.userData.collider=n,m.createCollider(n,a),b.push([e,a,e.id])),e.name.includes("itsmen_left_hand")&&(a=m.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),n=c.ColliderDesc.capsule(o.z/2,o.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),A.userData.body=a,A.userData.collider=n,m.createCollider(n,a),b.push([e,a,e.id])),e.name.includes("itsmen_right_hand")&&(a=m.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),n=c.ColliderDesc.capsule(o.z/2,o.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),B.userData.body=a,B.userData.collider=n,m.createCollider(n,a),b.push([e,a,e.id])),e.name.includes("itsmen_left_leg")&&(a=m.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),n=c.ColliderDesc.capsule(o.z/2,o.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),x.userData.body=a,x.userData.collider=n,m.createCollider(n,a),b.push([e,a,e.id])),e.name.includes("itsmen_right_leg")&&(a=m.createRigidBody(c.RigidBodyDesc.dynamic().setTranslation(e.position.x,e.position.y,e.position.z).setRotation(e.quaternion).setCanSleep(!1).enabledRotations(!1,!0,!1).setLinearDamping(0).setAngularDamping(0)),n=c.ColliderDesc.capsule(o.z/2,o.x/10).setMass(0).setRestitution(0).setFriction(0).setDensity(2),v.userData.body=a,v.userData.collider=n,m.createCollider(n,a),b.push([e,a,e.id]))}document.addEventListener("visibilitychange",function(){document.visibilityState==="visible"?!k&&C&&N==!1&&(_.start(),_.elapsedTime=t.userData.time):N==!1&&!k&&C&&(t.userData.time=_.getElapsedTime(),_.stop())});
